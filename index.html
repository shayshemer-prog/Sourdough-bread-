<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#8B4513">
    <title>××“×¨×™×š ×œ××¤×™×™×ª ×œ×—× ××—××¦×ª</title>
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiU291cmRvdWdoIEJyZWFkIEd1aWRlIiwic2hvcnRfbmFtZSI6IlNvdXJkb3VnaCIsInN0YXJ0X3VybCI6Ii8iLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsImJhY2tncm91bmRfY29sb3IiOiIjZmZmZmZmIiwidGhlbWVfY29sb3IiOiIjOEI0NTEzIn0=">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #f5e6d3 0%, #d4a574 100%);
            min-height: 100vh;
            padding-bottom: 80px;
            direction: rtl;
        }
        
        .header {
            background: linear-gradient(135deg, #8B4513 0%, #A0522D 100%);
            color: white;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header h1 {
            font-size: 1.5em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: space-between;
        }
        
        .active-timers {
            font-size: 0.7em;
            opacity: 0.9;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .timer-pulse {
            width: 8px;
            height: 8px;
            background: #4ade80;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .global-timers-section {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            padding: 12px;
            margin-top: 10px;
            display: block;
        }

        .global-timers-title {
            font-size: 1em;
            font-weight: 600;
            opacity: 0.95;
        }

        .global-timer-item {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            padding: 10px 12px;
            margin-bottom: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }

        .global-timer-item:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }

        .global-timer-item.active {
            background: rgba(255, 255, 255, 0.35);
            border-color: rgba(255, 255, 255, 0.5);
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }

        .global-timer-item:last-child {
            margin-bottom: 0;
        }

        .global-timer-label {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .global-timer-time {
            font-weight: bold;
            font-variant-numeric: tabular-nums;
            font-size: 1.1em;
        }

        .sticky-bread-selector {
            position: sticky;
            top: 0;
            z-index: 99;
            margin: -20px -20px 20px -20px;
            padding: 15px 20px;
            background: linear-gradient(135deg, #f5e6d3 0%, #d4a574 100%);
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            border-radius: 0 0 12px 12px;
        }

        .sticky-bread-selector h3 {
            font-size: 1.1em;
            margin: 0 0 10px 0;
            color: #5d4037;
        }

        .sticky-bread-selector .bread-item {
            background: white;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .sticky-bread-selector .bread-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(0,0,0,0.15);
        }

        .sticky-bread-selector .bread-item.active {
            background: linear-gradient(135deg, #fff9e6 0%, #ffe4b3 100%);
            border: 2px solid #d4a574;
        }

        .sticky-bread-selector .bread-name {
            font-size: 1em;
            font-weight: 600;
        }

        .sticky-bread-selector .bread-progress {
            font-size: 0.85em;
            color: #666;
        }

        .sticky-bread-selector .btn-delete {
            padding: 6px 10px;
            font-size: 1.2em;
            background: rgba(244, 67, 54, 0.1);
            border: 1px solid rgba(244, 67, 54, 0.3);
            transition: all 0.2s ease;
        }

        .sticky-bread-selector .btn-delete:hover {
            background: rgba(244, 67, 54, 0.2);
            border-color: rgba(244, 67, 54, 0.5);
        }
        
        .progress-bar {
            background: rgba(255,255,255,0.3);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }
        
        .progress-fill {
            background: white;
            height: 100%;
            transition: width 0.3s ease;
            border-radius: 4px;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .step-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .step-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .step-number {
            background: linear-gradient(135deg, #8B4513 0%, #A0522D 100%);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2em;
        }
        
        .step-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #2c3e50;
            flex: 1;
            margin-left: 15px;
        }
        
        .step-content {
            color: #555;
            line-height: 1.6;
            margin: 15px 0;
        }
        
        .ingredients {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .ingredients h4 {
            color: #8B4513;
            margin-bottom: 10px;
        }
        
        .ingredient-item {
            padding: 5px 0;
            color: #555;
        }
        
        .timer-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .timer-display {
            font-size: 2.5em;
            font-weight: bold;
            text-align: center;
            margin: 10px 0;
            font-variant-numeric: tabular-nums;
            cursor: pointer;
            padding: 10px;
            border-radius: 8px;
            transition: background 0.3s ease;
        }

        .timer-display:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .timer-display input {
            background: transparent;
            border: none;
            color: white;
            font-size: 1em;
            font-weight: bold;
            text-align: center;
            width: 100%;
            font-variant-numeric: tabular-nums;
            outline: none;
        }

        .timer-adjust {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 10px 0;
        }

        .btn-adjust {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 60px;
        }

        .btn-adjust:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .btn-adjust:active {
            transform: scale(0.95);
        }
        
        .timer-label {
            text-align: center;
            opacity: 0.9;
            margin-bottom: 15px;
        }
        
        .timer-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn:active {
            transform: scale(0.95);
        }
        
        .btn-primary {
            background: white;
            color: #667eea;
        }
        
        .btn-primary:hover {
            background: #f0f0f0;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
        }
        
        .btn-next {
            background: linear-gradient(135deg, #8B4513 0%, #A0522D 100%);
            color: white;
            width: 100%;
            margin-top: 20px;
            justify-content: center;
            font-size: 1.1em;
        }
        
        .btn-back {
            background: #95a5a6;
            color: white;
            margin-top: 10px;
        }
        
        .navigation {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .completion {
            text-align: center;
            padding: 40px 20px;
        }
        
        .completion h2 {
            color: #8B4513;
            font-size: 2em;
            margin: 20px 0;
        }
        
        .completion-icon {
            font-size: 4em;
        }
        
        .tips {
            background: #fff9e6;
            border-left: 4px solid #f39c12;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
        }
        
        .tips strong {
            color: #f39c12;
        }
        
        .hidden {
            display: none;
        }

        .temperature {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 10px 15px;
            border-radius: 4px;
            margin: 10px 0;
            font-weight: 500;
            color: #2e7d32;
        }

        .bread-selector {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .bread-selector h3 {
            color: #8B4513;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .bread-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .bread-item:hover {
            background: #e9ecef;
            transform: translateX(-5px);
        }

        .bread-item.active {
            background: linear-gradient(135deg, #fff9e6 0%, #ffe6cc 100%);
            border-color: #8B4513;
        }

        .bread-name {
            font-weight: 600;
            color: #2c3e50;
            font-size: 1.1em;
            margin-bottom: 5px;
        }

        .bread-progress {
            color: #777;
            font-size: 0.9em;
        }

        .bread-timer-info {
            font-size: 0.85em;
            color: #667eea;
            font-weight: 600;
            margin-top: 4px;
            font-variant-numeric: tabular-nums;
        }

        .bread-header {
            background: white;
            border-radius: 12px;
            padding: 15px 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.1em;
        }

        .btn-small {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            background: #95a5a6;
            color: white;
            transition: all 0.3s ease;
        }

        .btn-small:hover {
            background: #7f8c8d;
        }

        .btn-small:active {
            transform: scale(0.95);
        }

        .btn-delete {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 0.85em;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
        }

        .btn-delete:hover {
            background: #c0392b;
        }

        .btn-delete:active {
            transform: scale(0.95);
        }

        .bread-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .bread-item-info {
            flex: 1;
        }

        .recipe-loader {
            background: #fff3cd;
            border: 2px dashed #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .recipe-loader h4 {
            color: #856404;
            margin-bottom: 10px;
            font-size: 1em;
        }

        .recipe-loader input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ffc107;
            border-radius: 6px;
            margin-bottom: 10px;
            font-size: 0.9em;
            direction: ltr;
            text-align: left;
        }

        .recipe-loader button {
            background: #ffc107;
            color: #856404;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .recipe-loader button:hover {
            background: #e0a800;
        }

        .recipe-info {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
            padding: 10px 15px;
            border-radius: 4px;
            margin-bottom: 15px;
            font-size: 0.9em;
            color: #0c5460;
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            
            .step-card {
                padding: 20px;
            }
            
            .timer-display {
                font-size: 2em;
            }
            
            .btn {
                padding: 10px 16px;
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>
            <span>ğŸ ×œ×—× ××—××¦×ª</span>
            <span class="active-timers" id="activeTimersIndicator"></span>
        </h1>
        <div class="progress-bar">
            <div class="progress-fill" id="progressBar"></div>
        </div>
        <div class="global-timers-section" id="globalTimersSection">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; gap: 8px;">
                <div class="global-timers-title">ğŸ ×”×œ×—××™× ×©×œ×™</div>
                <div style="display: flex; gap: 6px;">
                    <button class="btn btn-success" onclick="createNewBread()" style="padding: 6px 12px; font-size: 0.85em;">
                        â• ×œ×—× ×—×“×©
                    </button>
                    <button class="btn" onclick="toggleRecipeLoader()" style="padding: 6px 12px; font-size: 0.85em; background: #ffc107; color: #856404;">
                        ğŸ“– ××ª×›×•×Ÿ
                    </button>
                </div>
            </div>

            <!-- Recipe Selector -->
            <div id="recipeSelectorSection" style="background: rgba(139, 69, 19, 0.2); border-radius: 6px; padding: 10px; margin-bottom: 10px;">
                <div style="font-weight: 600; margin-bottom: 8px; color: #d4a574; font-size: 0.9em;">
                    ğŸ“š ×‘×—×¨ ××ª×›×•×Ÿ
                </div>
                <select id="recipeSelector" onchange="handleRecipeSelection()" style="width: 100%; padding: 8px; border: 1px solid #d4a574; border-radius: 4px; font-size: 0.85em; background: white; color: #333; font-family: inherit;">
                    <option value="sourdough">ğŸ ×œ×—× ××—××¦×ª ×§×œ××¡×™ (13.5 ×©×¢×•×ª, ××ª×§×“×)</option>
                    <option value="mixerSourdough">ğŸ¥– ×œ×—× ××—××¦×ª ×‘××™×§×¡×¨ (11 ×©×¢×•×ª, ×‘×™× ×•× ×™)</option>
                </select>

                <!-- Recipe Preview -->
                <div id="recipePreviewBox" style="margin-top: 10px; background: rgba(255,255,255,0.1); border-radius: 4px; padding: 10px; display: none;">
                    <div style="font-weight: 600; margin-bottom: 6px; color: #ffd700; font-size: 0.85em;">
                        ğŸ‘ï¸ ×ª×¦×•×’×” ××§×“×™××”
                    </div>
                    <div id="recipePreviewContent" style="font-size: 0.75em; color: rgba(255,255,255,0.9);">
                        <!-- Preview content will be inserted here -->
                    </div>
                    <button onclick="previewRecipeDetails()" style="width: 100%; background: #4caf50; color: white; border: none; padding: 6px; border-radius: 4px; font-weight: 600; cursor: pointer; font-size: 0.75em; margin-top: 6px;">
                        ğŸ“‹ ×”×¦×’ ××ª ×›×œ ×”×©×œ×‘×™×
                    </button>
                </div>

                <div style="margin-top: 6px; font-size: 0.75em; color: rgba(255,255,255,0.9); text-align: center;">
                    ×‘×—×™×¨×ª ××ª×›×•×Ÿ ×ª××¤×¡ ××ª ×›×œ ×”×œ×—××™× ×”×§×™×™××™×
                </div>
                <button onclick="showAIPrompt()" style="width: 100%; background: #9c27b0; color: white; border: none; padding: 6px; border-radius: 4px; font-weight: 600; cursor: pointer; font-size: 0.75em; margin-top: 6px;">
                    ğŸ¤– ×”×¦×’ ×¤×¨×•××¤×˜ ×œ×™×¦×™×¨×ª ××ª×›×•×Ÿ ×—×“×© ×¢× AI
                </button>
            </div>

            <div id="recipeLoaderSection" style="display: none; margin-bottom: 10px;">
                <div style="background: rgba(255, 193, 7, 0.2); border-radius: 6px; padding: 10px;">
                    <div style="margin-bottom: 8px; font-size: 0.85em; color: rgba(255,255,255,0.95); font-weight: 600;">
                        ×”×“×‘×§ ××ª×›×•×Ÿ ××›×œ ××ª×¨:
                    </div>
                    <textarea id="recipeTextInput" placeholder="×”×“×‘×§ ×›××Ÿ ××ª ×”××ª×›×•×Ÿ ×”××œ× (×›×•×œ×œ ××¨×›×™×‘×™×, ×©×œ×‘×™×, ×–×× ×™×...)&#10;&#10;×œ×“×•×’××”:&#10;××¨×›×™×‘×™×:&#10;- 500 ×’×¨× ×§××—&#10;- 350 ×&quot;×œ ××™×&#10;&#10;×©×œ×‘×™×:&#10;1. ×¢×¨×‘×‘ ×§××— ×•××™×&#10;2. ×ª×Ÿ ×œ× ×•×— 30 ×“×§×•×ª&#10;..." style="width: 100%; min-height: 150px; padding: 8px; border: 1px solid #ffc107; border-radius: 4px; margin-bottom: 8px; font-size: 0.85em; font-family: inherit; resize: vertical;"></textarea>
                    <div style="display: flex; gap: 6px;">
                        <button onclick="parseRecipeText()" style="flex: 1; background: #ffc107; color: #856404; border: none; padding: 8px; border-radius: 4px; font-weight: 600; cursor: pointer; font-size: 0.85em;">ğŸ“– ×¤×¨×§ ××ª ×”××ª×›×•×Ÿ</button>
                        <button onclick="resetToDefaultRecipe()" style="flex: 1; background: #dc3545; color: white; border: none; padding: 8px; border-radius: 4px; font-weight: 600; cursor: pointer; font-size: 0.85em;">ğŸ”„ ××ª×›×•×Ÿ ××§×•×¨×™</button>
                    </div>
                    <div style="margin-top: 6px; font-size: 0.75em; color: rgba(255,255,255,0.9); text-align: center;">
                        ×”××¤×œ×™×§×¦×™×” ×ª× ×ª×— ××ª ×”××ª×›×•×Ÿ ×•×ª×—×œ×§ ××•×ª×• ×œ×©×œ×‘×™×
                    </div>
                </div>
            </div>
            <div id="globalTimersList"></div>
        </div>
    </div>

    <div class="container">
        <div id="stepContainer"></div>
    </div>

    <script>
        // ============================================
        // RECIPE LIBRARY - Multiple Built-in Recipes
        // ============================================

        /*
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        PROMPT FOR AI TO CREATE NEW RECIPES:
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        Create a bread recipe in the following JSON format. The recipe should be
        detailed, step-by-step, and include timers for each waiting period.

        Requirements:
        1. Recipe must be in Hebrew (right-to-left)
        2. Each step should have:
           - title: Short step name (e.g., "×¢×¨×‘×•×‘ ××¨×›×™×‘×™×", "×§×™×¤×•×œ ×¨××©×•×Ÿ")
           - content: Detailed instructions for this step
           - ingredients: Array of ingredients with amounts (ONLY in first step, null for others)
           - timer: {duration: minutes, label: "description"} or null if no waiting
           - temperature: Temperature info as string or null
           - tips: Helpful tips or null
        3. Include ALL steps from start to finish: mixing, resting, folding, shaping, proofing, baking, cooling
        4. Timer durations should be realistic (in minutes)
        5. Maximum 20 steps

        Return ONLY valid JavaScript array in this format:
        [
            {
                title: "Step name in Hebrew",
                content: "Detailed instructions in Hebrew",
                ingredients: ["ingredient 1 with amount", "ingredient 2"] or null,
                timer: {duration: 30, label: "Timer label in Hebrew"} or null,
                temperature: "Temperature info in Hebrew" or null,
                tips: "Helpful tips in Hebrew" or null
            },
            // ... more steps
        ]

        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        */

        const recipeLibrary = {
            sourdough: {
                name: "×œ×—× ××—××¦×ª ×§×œ××¡×™",
                description: "××ª×›×•×Ÿ ××¡×•×¨×ª×™ ×œ×œ×—× ××—××¦×ª ×¢× ×ª×¡×™×¡×” ××¨×•×›×”",
                totalTime: "13.5 ×©×¢×•×ª",
                difficulty: "××ª×§×“×",
                steps: [
                    {
                        title: "×”×›× ×ª ×”×©××•×¨",
                        content: "×•×“××• ×©×©××•×¨ ×”××—××¦×ª ×©×œ×›× ×¤×¢×™×œ ×•××‘×¢×‘×¢. ×”×•× ×¦×¨×™×š ×œ×”×›×¤×™×œ ××ª ×¢×¦××• ×‘×’×•×“×œ ×•×œ×¢×‘×•×¨ ××ª ××‘×—×Ÿ ×”×¦×™×¤×” (×›×¤×™×ª ×©××•×¨ ×¦×¤×” ×‘××™×).",
                        ingredients: [
                            "100 ×’×¨× ×©××•×¨ ×¤×¢×™×œ",
                            "500 ×’×¨× ×§××— ×œ×—× (××• ×§××— ×¨×’×™×œ)",
                            "350 ×’×¨× ××™× (×‘×˜××¤×¨×˜×•×¨×ª ×”×—×“×¨)",
                            "10 ×’×¨× ××œ×—"
                        ],
                        timer: null,
                        tips: "×× ×”×©××•×¨ ×œ× ×”×•×–×Ÿ ×œ××—×¨×•× ×”, ×”××›×™×œ×• ××•×ª×• 4-8 ×©×¢×•×ª ×œ×¤× ×™ ×”×”×ª×—×œ×”. ×”×•× ×¦×¨×™×š ×œ×”×¨×™×— ×—××¦××¥ ×•××ª×•×§ ××¢×˜."
                    },
            {
                title: "××•×˜×•×œ×™×–×” (×¢×¨×‘×•×‘ ×§××— ×•××™×)",
                content: "×¢×¨×‘×‘×• ××ª ×”×§××— ×•-325 ×’×¨× ××™× (×©××¨×• 25 ×’×¨× ×œ×××•×—×¨ ×™×•×ª×¨) ×‘×§×¢×¨×” ×’×“×•×œ×”. ×¢×¨×‘×‘×• ×¢×“ ×©×œ× × ×©××¨ ×§××— ×™×‘×©. ×–×” ×××¤×©×¨ ×œ×§××— ×œ×”×¡×¤×’ ×•××¤×ª×— ×’×œ×•×˜×Ÿ ×‘××•×¤×Ÿ ×˜×‘×¢×™.",
                timer: { duration: 30, label: "×× ×•×—×ª ××•×˜×•×œ×™×–×”" },
                tips: "××œ ×ª×•×¡×™×¤×• ××œ×— ××• ×©××•×¨ ×¢×“×™×™×Ÿ! ×ª×§×•×¤×ª ×”×× ×•×—×” ×”×–×• ×”×•×¤×›×ª ××ª ×”×‘×¦×§ ×œ×§×œ ×™×•×ª×¨ ×œ×¢×‘×•×“×”."
            },
            {
                title: "×”×•×¡×¤×ª ×©××•×¨ ×•××œ×—",
                content: "×”×•×¡×™×¤×• ××ª ×”×©××•×¨ ×”×¤×¢×™×œ ×•×”××œ×— ×œ×‘×¦×§. ×”×©×ª××©×• ×‘-25 ×’×¨× ×”××™× ×”× ×•×ª×¨×™× ×›×“×™ ×œ×¡×™×™×¢ ×‘×”××¡×ª ×”××œ×—. ×œ×—×¦×• ×”×›×œ ×‘×™×—×“ ×¢× ×”×™×“×™×™× ×¢×“ ×©×”×›×œ ××©×•×œ×‘ ×œ×—×œ×•×˜×™×Ÿ - ×–×” ×™×”×™×” ×“×‘×™×§ ×•××‘×•×œ×’×Ÿ!",
                timer: { duration: 2, label: "×¢×¨×‘×•×‘ ×©××•×¨ ×•××œ×—" },
                tips: "×”×¨×˜×™×‘×• ××ª ×”×™×“×™×™× ×›×“×™ ×œ×× ×•×¢ ×”×™×“×‘×§×•×ª. ×”×‘×¦×§ ×™×”×™×” ×¤×¨×•×¢ ×‘×”×ª×—×œ×” - ×–×” × ×•×¨××œ×™."
            },
            {
                title: "××ª×™×—×” ×•×§×™×¤×•×œ #1",
                content: "×¢×›×©×™×• ××ª×—×™×œ×” ×”×ª×¡×™×¡×” ×”×¨××©×•× ×™×ª! ×‘×¦×¢×• ××ª ×¡×˜ ×”××ª×™×—×” ×•×”×§×™×¤×•×œ ×”×¨××©×•×Ÿ: ×”×¨×˜×™×‘×• ××ª ×”×™×“×™×™×, ××—×–×• ×‘×¦×“ ××—×“ ×©×œ ×”×‘×¦×§, ××ª×—×• ××•×ª×• ×œ××¢×œ×”, ×•×§×¤×œ×• ××•×ª×•. ×¡×•×‘×‘×• ××ª ×”×§×¢×¨×” 90 ××¢×œ×•×ª ×•×—×–×¨×• 4 ×¤×¢××™× (×¦×¤×•×Ÿ, ×“×¨×•×, ××–×¨×—, ××¢×¨×‘).",
                timer: { duration: 30, label: "×¢×“ ××ª×™×—×” ×•×§×™×¤×•×œ #2" },
                temperature: "×©××¨×• ×‘×˜××¤×¨×˜×•×¨×” ×©×œ 24-26Â°C. ×—× ×™×•×ª×¨ = ×ª×¡×™×¡×” ××”×™×¨×” ×™×•×ª×¨.",
                tips: "×”×‘×¦×§ ×™×”×™×” ×¨×š ×•×“×‘×™×§. ××œ ×ª×•×¡×™×¤×• ×™×•×ª×¨ ××“×™ ×§××— - ×¨×§ ×”×¨×˜×™×‘×• ××ª ×”×™×“×™×™×."
            },
            {
                title: "××ª×™×—×” ×•×§×™×¤×•×œ #2",
                content: "×‘×¦×¢×• ××ª ×¡×˜ ×”××ª×™×—×” ×•×”×§×™×¤×•×œ ×”×©× ×™: ×”×¨×˜×™×‘×• ××ª ×”×™×“×™×™×, ××ª×—×• ×•×§×¤×œ×• ××›×œ 4 ×”×¦×“×“×™×. ×”×‘×¦×§ ×›×‘×¨ ×××•×¨ ×œ×”×¨×’×™×© ×§×¦×ª ×™×•×ª×¨ ×—×–×§ ×•×¤×—×•×ª ×“×‘×™×§.",
                timer: { duration: 30, label: "×¢×“ ××ª×™×—×” ×•×§×™×¤×•×œ #3" },
                temperature: "×©××¨×• ×‘×˜××¤×¨×˜×•×¨×” ×©×œ 24-26Â°C.",
                tips: "×©×™××• ×œ×‘ ××™×š ×”×‘×¦×§ ××ª×—×™×œ ×œ×¤×ª×— ××‘× ×” ×•×›×•×—."
            },
            {
                title: "××ª×™×—×” ×•×§×™×¤×•×œ #3",
                content: "×‘×¦×¢×• ××ª ×¡×˜ ×”××ª×™×—×” ×•×”×§×™×¤×•×œ ×”×©×œ×™×©×™: ×”×¨×˜×™×‘×• ××ª ×”×™×“×™×™×, ××ª×—×• ×•×§×¤×œ×• ××›×œ 4 ×”×¦×“×“×™×. ×”×‘×¦×§ ×××•×¨ ×œ×”×¨×’×™×© ×”×¨×‘×” ×™×•×ª×¨ ×—×œ×§ ×•××œ×¡×˜×™.",
                timer: { duration: 30, label: "×¢×“ ××ª×™×—×” ×•×§×™×¤×•×œ #4" },
                temperature: "×©××¨×• ×‘×˜××¤×¨×˜×•×¨×” ×©×œ 24-26Â°C.",
                tips: "×”×‘×¦×§ ×××•×¨ ×œ×”×ª×—×™×œ ×œ×”×¨××•×ª ××•×•×¨×™×¨×™ ×¢× ×‘×•×¢×•×ª ×§×˜× ×•×ª."
            },
            {
                title: "××ª×™×—×” ×•×§×™×¤×•×œ #4 (××—×¨×•×Ÿ)",
                content: "×‘×¦×¢×• ××ª ×¡×˜ ×”××ª×™×—×” ×•×”×§×™×¤×•×œ ×”××—×¨×•×Ÿ: ×”×¨×˜×™×‘×• ××ª ×”×™×“×™×™×, ××ª×—×• ×•×§×¤×œ×• ××›×œ 4 ×”×¦×“×“×™×. ×–×” ×”×¡×˜ ×”××—×¨×•×Ÿ ×œ×¤× ×™ ×”×× ×•×—×” ×”××¨×•×›×”.",
                timer: { duration: 30, label: "×”×ª×—×œ×ª ×× ×•×—×”" },
                temperature: "×©××¨×• ×‘×˜××¤×¨×˜×•×¨×” ×©×œ 24-26Â°C.",
                tips: "××—×¨×™ ×”×˜×™×™××¨ ×”×–×”, ×¢×‘×¨×• ×œ×©×œ×‘ ×”×‘× - ×× ×•×—×ª ×”×ª×¡×™×¡×”."
            },
            {
                title: "×× ×•×—×ª ×ª×¡×™×¡×” ×¨××©×•× ×™×ª",
                content: "×¢×›×©×™×• ×ª× ×• ×œ×‘×¦×§ ×œ× ×•×— ×œ×œ× ×”×¤×¨×¢×” ×œ××©×š 2-2.5 ×©×¢×•×ª. ×›×¡×• ××ª ×”×§×¢×¨×” ×”×™×˜×‘. ×”×‘×¦×§ ×¦×¨×™×š ×œ×’×“×•×œ ×‘-30-50% ×‘× ×¤×— ×•×œ×”×¨×’×™×© ××•×•×¨×™×¨×™ ×•××œ× ×‘×•×¢×•×ª.",
                timer: { duration: 120, label: "×× ×•×—×ª ×ª×¡×™×¡×”" },
                temperature: "×©××¨×• ×‘×˜××¤×¨×˜×•×¨×” ×©×œ 24-26Â°C.",
                tips: "××œ ×ª×¤×¨×™×¢×• ×œ×‘×¦×§! ×–×” ×”×–××Ÿ ×©×‘×• ×”×•× ××¤×ª×— ×˜×¢× ×•××‘× ×”. ×”×•× ×¦×¨×™×š ×œ×”×™×¨××•×ª × ×¤×•×— ×•××œ× ×—×™×™×."
            },
            {
                title: "×¢×™×¦×•×‘ ×•×¢×™×¦×•×‘ ××§×“×™×",
                content: "×”×¤×›×• ××ª ×”×‘×¦×§ ×¢×œ ××©×˜×— ××§×•××— ×§×œ×•×ª. ×¢×¦×‘×• ×‘×¢×“×™× ×•×ª ×œ×›×“×•×¨ ×¢×œ ×™×“×™ ××©×™×›×ª ×”×§×¦×•×•×ª ×œ××¨×›×–. ×ª× ×• ×œ×• ×œ× ×•×— 20-30 ×“×§×•×ª (×× ×•×—×ª ×¡×¤×¡×œ), ×•××– ×‘×¦×¢×• ××ª ×”×¢×™×¦×•×‘ ×”×¡×•×¤×™: ×”×¤×›×• ××•×ª×•, ×¦×¨×• ××ª×— ×¢×œ ×™×“×™ ××©×™×›×ª ×”×‘×¦×§ ×œ×¢×‘×¨×›× ×ª×•×š ×›×“×™ ×¡×™×‘×•×‘.",
                timer: { duration: 25, label: "×× ×•×—×ª ×¡×¤×¡×œ" },
                tips: "××œ ×ª×•×¡×™×¤×• ×™×•×ª×¨ ××“×™ ×§××—! ××ª× ×¨×•×¦×™× ×©×”×‘×¦×§ ×™×™×“×‘×§ ××¢×˜ ×œ×©×•×œ×—×Ÿ ×›×“×™ ×œ×™×¦×•×¨ ××ª×—."
            },
            {
                title: "×ª×¤×™×—×” ×§×¨×” ×‘××§×¨×¨",
                content: "×”× ×™×—×• ××ª ×”×‘×¦×§ ×”××¢×•×¦×‘ ×¢× ×”×¦×“ ×”×ª×¤×•×¨ ×›×œ×¤×™ ××¢×œ×” ×‘×¡×œ ×ª×¡×™×¡×” ××§×•××— ××• ×‘×§×¢×¨×” ××¨×•×¤×“×ª ×‘××’×‘×ª. ×›×¡×• ×”×™×˜×‘ ×•×”×›× ×™×¡×• ×œ××§×¨×¨ ×œ-8-24 ×©×¢×•×ª. ×–×” ××¤×ª×— ×˜×¢× ×•×”×•×¤×š ××ª ×”×—×¨×™×¦×” ×œ×§×œ×” ×™×•×ª×¨.",
                timer: { duration: 480, label: "×ª×¤×™×—×” ×§×¨×” (××™× ×™××•× 8 ×©×¢×•×ª)" },
                tips: "××¨×•×š ×™×•×ª×¨ = ×˜×¢× ×—××•×¥ ×™×•×ª×¨! ××¤×©×¨ ×œ×”×’×™×¢ ×¢×“ 36 ×©×¢×•×ª ×‘××™×“×ª ×”×¦×•×¨×š."
            },
            {
                title: "×—×™××•× ×”×ª× ×•×¨",
                content: "×—×××• ××ª ×”×ª× ×•×¨ ×œ-260Â°C ×¢× ×¡×™×¨ ×”×•×œ× ×“×™ ×‘×¤× ×™×. ×ª×•×š ×›×“×™, ×”×•×¦×™××• ××ª ×”×‘×¦×§ ××”××§×¨×¨ ×•×”× ×™×—×• ×¢×œ × ×™×™×¨ ××¤×™×™×”. ×—×¨×¦×• ×‘×–×”×™×¨×•×ª ×¢× ×œ×”×‘ ×—×“.",
                timer: { duration: 50, label: "×—×™××•× ×”×ª× ×•×¨" },
                temperature: "×ª× ×•×¨: 260Â°C",
                tips: "×—×©×•×‘ ×œ×—×× ××ª ×”×¡×™×¨ ×”×”×•×œ× ×“×™ ×™×—×“ ×¢× ×”×ª× ×•×¨ ×›×“×™ ×©×™×”×™×” ×—× ×××•×“."
            },
            {
                title: "××¤×™×™×” ×¢× ××›×¡×”",
                content: "×”× ×™×—×• ××ª ×”×‘×¦×§ ×‘×¡×™×¨ ×”×”×•×œ× ×“×™ ×”×—× ×‘×–×”×™×¨×•×ª (×”×©×ª××©×• ×‘× ×™×™×¨ ×”××¤×™×™×” ×›×“×™ ×œ×”×¨×™× ××•×ª×•). ×¡×’×¨×• ××ª ×”××›×¡×” ×•××¤×• ×‘-260Â°C.",
                timer: { duration: 20, label: "××¤×™×™×” ×¢× ××›×¡×”" },
                temperature: "×ª× ×•×¨: 260Â°C",
                tips: "×”××›×¡×” ×™×•×¦×¨ ××“×™× ×©×¢×•×–×¨×™× ×œ×œ×—× ×œ×”×ª×¤×ª×— ×•×œ×§×‘×œ ×§×¨×•× ×™×¤×”."
            },
            {
                title: "××¤×™×™×” ×œ×œ× ××›×¡×”",
                content: "×”×¡×™×¨×• ××ª ×”××›×¡×” ×‘×–×”×™×¨×•×ª (×™×”×™×” ×”×¨×‘×” ××“×™×!). ×”×•×¨×™×“×• ××ª ×”×˜××¤×¨×˜×•×¨×” ×œ-230Â°C ×•×”××©×™×›×• ×œ××¤×•×ª ×¢×“ ×©×”×œ×—× ××§×‘×œ ×¦×‘×¢ ×—×•× ×–×”×•×‘.",
                timer: { duration: 28, label: "××¤×™×™×” ×œ×œ× ××›×¡×”" },
                temperature: "×ª× ×•×¨: 230Â°C",
                tips: "×”×œ×—× ×¦×¨×™×š ×œ×”×™×•×ª ×—×•× ×–×”×•×‘ ×™×¤×”. ××œ ×ª×¤×—×“×• ××¦×‘×¢ ×›×”×” - ×–×” ××•×¡×™×£ ×˜×¢×!"
            },
            {
                title: "×§×™×¨×•×¨ ××œ×",
                content: "×”×•×¦×™××• ××ª ×”×œ×—× ×•×”× ×™×—×• ××•×ª×• ×¢×œ ×¨×©×ª ×§×™×¨×•×¨. ×–×” ×”×—×œ×§ ×”×§×©×” ×‘×™×•×ª×¨ - ××ª× ×—×™×™×‘×™× ×œ×—×›×•×ª ×œ×¤×—×•×ª 1-2 ×©×¢×•×ª ×œ×¤× ×™ ×”×—×™×ª×•×š! ×”×œ×—× ×¢×“×™×™×Ÿ ××ª×‘×©×œ ×‘×¤× ×™× ×•×”×¤×™×¨×•×¨×™×ª ××ª×§×‘×¢×ª.",
                timer: { duration: 90, label: "×–××Ÿ ×§×™×¨×•×¨" },
                tips: "×”×§×©×™×‘×• ×œ×•! ×œ×—× ×˜×¨×™ ××•×¦×™× ×¦×œ×™×œ×™ ×¤×¦×¤×•×¥ ×›×©×”×•× ××ª×§×¨×¨. ×× ×ª×—×ª×›×• ××•×§×“× ××“×™, ×”×¤× ×™× ×™×”×™×” ×“×‘×™×§."
            }
                ]
            },
            mixerSourdough: {
                name: "×œ×—× ××—××¦×ª ×‘××™×§×¡×¨",
                description: "××ª×›×•×Ÿ ×œ×œ×—× ××—××¦×ª ×¢× ×©×™××•×© ×‘××™×§×¡×¨ - ×§×œ ×™×•×ª×¨ ×•××”×™×¨ ×™×•×ª×¨",
                totalTime: "10.5 ×©×¢×•×ª",
                difficulty: "×‘×™× ×•× ×™",
                steps: [
                    {
                        title: "×¢×¨×‘×•×‘ ×¨××©×•× ×™ ×•××•×˜×•×œ×™×–×”",
                        content: "××¢×¨×‘×‘×™× ×‘×§×¢×¨×ª ××™×§×¡×¨ ××ª ×”×§××— ×”×œ×‘×Ÿ, ×”×§××— ×”××œ× ×•×”××™× ×‘××©×š 1-2 ×“×§×•×ª ×¨×§ ×¢×“ ×©×”×§××— × ×˜××¢. ××›×¡×™× ××ª ×”×§×¢×¨×” ×‘××’×‘×ª ×•×× ×™×—×™× ×œ×‘×¦×§ ×œ× ×•×— ×‘×˜××¤×¨×˜×•×¨×ª ×”×—×“×¨.",
                        ingredients: [
                            "320 ×’×¨× ×§××— ×œ×‘×Ÿ",
                            "80 ×’×¨× ×§××— ××œ× (×©×™×¤×•×Ÿ ××• ×›×•×¡××™×Ÿ)",
                            "300 ×’×¨× ××™×",
                            "80 ×’×¨× ××—××¦×ª ×¤×¢×™×œ×”",
                            "8 ×’×¨× ××œ×—"
                        ],
                        timer: { duration: 90, label: "×× ×•×—×” (××•×˜×•×œ×™×–×”) ×œ×©×™×¤×•×¨ ×”×’×œ×•×˜×Ÿ" },
                        temperature: "×˜××¤×¨×˜×•×¨×ª ×”×—×“×¨",
                        tips: "×”××•×˜×•×œ×™×–×” ××§×¦×¨×ª ××ª ×–××Ÿ ×”×œ×™×©×” ×•×”×•×¤×›×ª ××ª ×”×‘×¦×§ ×œ×’××™×© ×•× ×•×— ×™×•×ª×¨ ×œ×¢×‘×•×“×”."
                    },
                    {
                        title: "×”×•×¡×¤×ª ××—××¦×ª ×•×œ×™×©×”",
                        content: "××•×¡×™×¤×™× ××ª ×”××—××¦×ª ×œ×‘×¦×§ ×•×œ×©×™× ×‘××”×™×¨×•×ª × ××•×›×” ×‘××™×§×¡×¨.",
                        ingredients: null,
                        timer: { duration: 3, label: "×œ×™×©×” ×¢× ××—××¦×ª" },
                        temperature: null,
                        tips: "×—×©×•×‘ ×œ×•×•×“× ×©×”××—××¦×ª ×‘×©×™××” - ×‘×•×¢×ª×™×ª, ×¤×¢×™×œ×” ×•×œ××—×¨ ×©×”×›×¤×™×œ×” ××ª × ×¤×—×”."
                    },
                    {
                        title: "×”×•×¡×¤×ª ××œ×— ×•×œ×™×©×” ×¡×•×¤×™×ª",
                        content: "××•×¡×™×¤×™× ××ª ×”××œ×— ×•×××©×™×›×™× ×œ×œ×•×© ×‘××”×™×¨×•×ª × ××•×›×”. ×”×‘×¦×§ ××•×›×Ÿ ×›××©×¨ ×”×•× × ×™×ª×§ ××“×¤× ×•×ª ×”×§×¢×¨×” ××š × ×•×ª×¨ ××—×•×‘×¨ ××¢×˜ ×‘×ª×—×ª×™×ª.",
                        ingredients: null,
                        timer: { duration: 5, label: "×œ×™×©×” ×¢× ××œ×—" },
                        temperature: null,
                        tips: "××œ ×ª×ª×¤×ª×• ×œ×”×’×‘×™×¨ ××ª ××”×™×¨×•×ª ×”××™×§×¡×¨; ×œ×™×©×” ××™×˜×™×ª ×©×•××¨×ª ×¢×œ ××‘× ×” ×”×‘×¦×§."
                    },
                    {
                        title: "×× ×•×—×” ×¨××©×•× ×”",
                        content: "××¢×‘×™×¨×™× ××ª ×”×‘×¦×§ ×œ×§×¢×¨×” × ×§×™×™×”, ××›×¡×™× ×‘××’×‘×ª ×•×× ×™×—×™× ×œ×• ×œ× ×•×—.",
                        ingredients: null,
                        timer: { duration: 30, label: "×× ×•×—×” ×œ×¤× ×™ ×ª×—×™×œ×ª ×”×§×™×¤×•×œ×™×" },
                        temperature: null,
                        tips: null
                    },
                    {
                        title: "×¡×“×¨×ª ×§×™×¤×•×œ×™× - ×—×œ×§ ×'",
                        content: "××‘×¦×¢×™× ××ª ×”×§×™×¤×•×œ ×”×¨××©×•×Ÿ: ××¨×˜×™×‘×™× ××¢×˜ ××ª ×”×™×“×™×™×, ××•×ª×—×™× ×¦×“ ××—×“ ×©×œ ×”×‘×¦×§ ×›×œ×¤×™ ××¢×œ×” ×•×× ×™×—×™× ××•×ª×• ×‘×¢×“×™× ×•×ª ×‘×¦×“ ×”× ×’×“×™. ×—×•×–×¨×™× ×¢×œ ×”×¤×¢×•×œ×” ×¢× ××¨×‘×¢×ª ×¦×“×“×™ ×”×‘×¦×§ ×•××›×¡×™×.",
                        ingredients: null,
                        timer: { duration: 30, label: "×× ×•×—×” ×‘×™×Ÿ ×§×™×¤×•×œ×™×" },
                        temperature: null,
                        tips: "×¢×‘×•×“×” ×¢× ×™×“×™×™× ×¨×˜×•×‘×•×ª ××•× ×¢×ª ××”×‘×¦×§ ×œ×”×™×“×‘×§ ×•××§×œ×” ×¢×œ ×”××ª×™×—×”."
                    },
                    {
                        title: "×¡×“×¨×ª ×§×™×¤×•×œ×™× - ×—×œ×§ ×‘'",
                        content: "××‘×¦×¢×™× ×§×™×¤×•×œ ×©× ×™ ×‘××•×ª×• ××•×¤×Ÿ: ××ª×™×—×” ×©×œ ××¨×‘×¢×ª ×”×¦×“×“×™× ×›×œ×¤×™ ×”××¨×›×– ×•×× ×•×—×”.",
                        ingredients: null,
                        timer: { duration: 30, label: "×× ×•×—×” ×‘×™×Ÿ ×§×™×¤×•×œ×™×" },
                        temperature: null,
                        tips: "×”×§×™×¤×•×œ×™× ××—×–×§×™× ××ª ×”×‘×¦×§ ×•×›×•×œ××™× ×‘×ª×•×›×• ××•×•×™×¨ ×œ×™×¦×™×¨×ª ×‘×•×¢×•×ª."
                    },
                    {
                        title: "×¡×“×¨×ª ×§×™×¤×•×œ×™× - ×—×œ×§ ×’'",
                        content: "××‘×¦×¢×™× ×§×™×¤×•×œ ×©×œ×™×©×™ ×©×œ ××¨×‘×¢×ª ×¦×“×“×™ ×”×‘×¦×§ ×•××›×¡×™×.",
                        ingredients: null,
                        timer: { duration: 30, label: "×× ×•×—×” ×‘×™×Ÿ ×§×™×¤×•×œ×™×" },
                        temperature: null,
                        tips: null
                    },
                    {
                        title: "×¡×“×¨×ª ×§×™×¤×•×œ×™× - ×—×œ×§ ×“'",
                        content: "××‘×¦×¢×™× ×§×™×¤×•×œ ×¨×‘×™×¢×™ ×•××—×¨×•×Ÿ. ×œ××—×¨ ×”×§×™×¤×•×œ ×”×‘×¦×§ ×××•×¨ ×œ×”×™×•×ª ×—×–×§ ×•×ª×¤×•×— ×™×•×ª×¨.",
                        ingredients: null,
                        timer: { duration: 30, label: "×× ×•×—×” ×œ×¤× ×™ ×¢×™×¦×•×‘ ××§×“×™×" },
                        temperature: null,
                        tips: null
                    },
                    {
                        title: "×¢×™×¦×•×‘ ××§×“×™×",
                        content: "××¢×‘×™×¨×™× ××ª ×”×‘×¦×§ ×œ××©×˜×— ×¢×‘×•×“×”. ×™×•×¦×¨×™× ×§×™×¤×•×œ×™× × ×•×¡×¤×™× ×œ×™×¦×™×¨×ª ×—×œ×§ ×¢×œ×™×•×Ÿ ×—×œ×§ ×•××ª×•×— ×‘×¢×–×¨×ª ×”×™×“×™×™× ××• ×§×œ×£.",
                        ingredients: null,
                        timer: { duration: 30, label: "×× ×•×—×” ×œ×¤× ×™ ×¢×™×¦×•×‘ ×¡×•×¤×™" },
                        temperature: null,
                        tips: "×©×œ×‘ ×–×” ×¢×•×–×¨ ×œ×™×¦×•×¨ '××ª×— ×¤× ×™×' ×©×™×¢×–×•×¨ ×œ×œ×—× ×œ×¢×œ×•×ª ×œ××¢×œ×” ×‘××¤×™×™×” ×•×œ× ×œ×”×©×ª×˜×—."
                    },
                    {
                        title: "×¢×™×¦×•×‘ ×¡×•×¤×™",
                        content: "××¢×¦×‘×™× ××ª ×”×‘×¦×§ ×œ×¦×•×¨×ª ×”×›×™×›×¨ ×”×¨×¦×•×™×” (×¢×’×•×œ×” ××• ××œ×‘× ×™×ª). ××§×¤×™×“×™× ×©×›×œ ×”×§×™×¤×•×œ×™× ×™×”×™×• ×‘×—×œ×§ ×”×ª×—×ª×•×Ÿ.",
                        ingredients: null,
                        timer: null,
                        temperature: null,
                        tips: "× ×™×ª×Ÿ ×œ×”×©×ª××© ×‘×§××— ××•×¨×– ×œ×§×™××•×— ×”×¡×œ×¡×œ×” ×›×“×™ ×œ×× ×•×¢ ×”×™×“×‘×§×•×ª."
                    },
                    {
                        title: "×”×ª×¤×—×” ×©× ×™×™×”",
                        content: "××¢×‘×™×¨×™× ××ª ×”×›×™×›×¨ ×œ×¡×œ×¡×œ×ª ×”×ª×¤×—×” ××• ×œ×§×¢×¨×” ×¢× ××’×‘×ª ××§×•××—×ª ×‘×ª×•×›×” ×•××›×¡×™×. ××ª×¤×™×—×™× ×‘×˜××¤×¨×˜×•×¨×ª ×”×—×“×¨ ×¢×“ ×©×”×‘×¦×§ ×ª×•×¤×— ×‘×›-80%.",
                        ingredients: null,
                        timer: { duration: 240, label: "×”×ª×¤×—×” ×‘×˜××¤×¨×˜×•×¨×ª ×”×—×“×¨" },
                        temperature: "×˜××¤×¨×˜×•×¨×ª ×”×—×“×¨",
                        tips: "× ×™×ª×Ÿ ×œ×”×ª×¤×™×— ×‘××§×¨×¨ ×œ××©×š 12-18 ×©×¢×•×ª ×œ×§×‘×œ×ª ×˜×¢××™× ×¢××•×§×™× ×™×•×ª×¨."
                    },
                    {
                        title: "×—×™××•× ×”×ª× ×•×¨ ×•×”×¡×™×¨",
                        content: "××—×××™× ×ª× ×•×¨ ×œ-250 ××¢×œ×•×ª ×•××›× ×™×¡×™× ×œ×ª×•×›×• ×¡×™×¨ ×‘×¨×–×œ ×™×¦×•×§ ×¢× ×”××›×¡×” ×¢×“ ×©×”× ×œ×•×”×˜×™× ×œ×’××¨×™.",
                        ingredients: null,
                        timer: { duration: 30, label: "×—×™××•× ×”×ª× ×•×¨ ×•×”×¡×™×¨" },
                        temperature: "250 ××¢×œ×•×ª",
                        tips: "×”×¡×™×¨ ×”×œ×•×”×˜ ×›×•×œ× ××ª ×”×œ×—×•×ª ××”×‘×¦×§ ×•×™×•×¦×¨ ×§×¨××¡×˜ ×¤×¨×™×š."
                    },
                    {
                        title: "×—×¨×™×¦×”",
                        content: "×× ×™×—×™× ××ª ×”×‘×¦×§ ×‘×–×”×™×¨×•×ª ×¨×‘×” ×¢×œ ××›×¡×” ×”×¡×™×¨ ×”×œ×•×”×˜ ××• ×‘×ª×•×›×•. ×‘×¢×–×¨×ª ×¡×›×™×Ÿ ×—×“×” ×××•×“ ××• ×ª×¢×¨, ××‘×¦×¢×™× ×—×¨×™×¥ ×¢××•×§ (×›-1 ×¡\"×) ×œ××•×¨×š ×”×›×™×›×¨.",
                        ingredients: null,
                        timer: null,
                        temperature: null,
                        tips: "×—×¨×™×¦×” ×‘×‘×™×˜×—×•×Ÿ ×•×‘××”×™×¨×•×ª ×××¤×©×¨×ª ×œ×œ×—× '×œ×¤×¨×•×—' ×•×œ×”×ª×¨×—×‘ ×‘×ª× ×•×¨."
                    },
                    {
                        title: "××¤×™×™×” ×¡×’×•×¨×”",
                        content: "××›×¡×™× ××ª ×”×¡×™×¨ ×•××›× ×™×¡×™× ×œ×ª× ×•×¨.",
                        ingredients: null,
                        timer: { duration: 25, label: "××¤×™×™×” ×¢× ××›×¡×”" },
                        temperature: "250 ××¢×œ×•×ª",
                        tips: "×”××›×¡×” ×©×•××¨ ×¢×œ ×”××“×™× ×”× ×—×•×¦×™× ×œ×”×ª×¤×ª×—×•×ª ×”×§×¨×•×."
                    },
                    {
                        title: "××¤×™×™×” ×¤×ª×•×—×”",
                        content: "××¡×™×¨×™× ××ª ×”××›×¡×” ×‘×–×”×™×¨×•×ª, ××•×¨×™×“×™× ××ª ×”×˜××¤×¨×˜×•×¨×” ×•×××©×™×›×™× ×œ××¤×•×ª ×¢×“ ×©×”×œ×—× ×©×–×•×£ ×××•×“ ×•×‘×¢×œ ×¦×‘×¢ ×¢××•×§.",
                        ingredients: null,
                        timer: { duration: 25, label: "××¤×™×™×” ×œ×œ× ××›×¡×”" },
                        temperature: "220 ××¢×œ×•×ª",
                        tips: "× ×™×ª×Ÿ ×œ×‘×“×•×§ ×©×”×œ×—× ××•×›×Ÿ ×× ×˜××¤×¨×˜×•×¨×ª ×”×œ×™×‘×” ×©×œ×• ×”×™× ×¡×‘×™×‘ 96-98 ××¢×œ×•×ª."
                    },
                    {
                        title: "×¦×™× ×•×Ÿ",
                        content: "××•×¦×™××™× ××ª ×”×œ×—× ××”×¡×™×¨ ×•×× ×™×—×™× ××•×ª×• ×¢×œ ×¨×©×ª ×¦×™× ×•×Ÿ.",
                        ingredients: null,
                        timer: { duration: 60, label: "×¦×™× ×•×Ÿ ×”×œ×—×" },
                        temperature: null,
                        tips: "××œ ×ª×¤×¨×¡×• ××ª ×”×œ×—× ×‘×¢×•×“×• ×—×! ×”×¦×™× ×•×Ÿ ×”×›×¨×—×™ ×œ×”×©×œ××ª ×”××¨×§× ×”×¤× ×™××™ ×•×× ×™×¢×ª ×“×‘×™×§×•×ª."
                    }
                ]
            }
        };

        // Get selected recipe from localStorage or default to sourdough
        let currentRecipeKey = localStorage.getItem('selectedRecipe') || 'sourdough';
        let recipeSteps = recipeLibrary[currentRecipeKey].steps;

        // Multi-bread support
        let breads = {};
        let currentBreadId = null;
        let timerUpdateInterval = null;
        let breadCounter = 0; // Track the highest bread number ever created

        function getCurrentBread() {
            if (!currentBreadId || !breads[currentBreadId]) {
                return null;
            }
            return breads[currentBreadId];
        }

        function calculateTotalRecipeTime() {
            // Calculate total time of all timers in the recipe
            let totalMinutes = 0;
            recipeSteps.forEach(step => {
                if (step.timer && step.timer.duration) {
                    totalMinutes += step.timer.duration;
                }
            });
            return totalMinutes;
        }

        function calculateTimeBasedProgress(bread) {
            const totalRecipeTime = calculateTotalRecipeTime();
            if (totalRecipeTime === 0) {
                // Fallback to step-based if no timers
                return Math.round((bread.currentStep + 1) / recipeSteps.length * 100);
            }

            // Calculate time already completed (all steps before current)
            let completedTime = 0;
            for (let i = 0; i < bread.currentStep; i++) {
                const step = recipeSteps[i];
                if (step.timer && step.timer.duration) {
                    completedTime += step.timer.duration;
                }
            }

            // Add time from current step's timer if it exists
            const currentStep = recipeSteps[bread.currentStep];
            if (currentStep && currentStep.timer && currentStep.timer.duration) {
                const timerId = `timer-${bread.currentStep}`;
                const timer = bread.timers[timerId];

                if (timer) {
                    const remaining = getTimerRemaining(timer);
                    const elapsed = currentStep.timer.duration * 60 - remaining; // Convert to seconds
                    completedTime += elapsed / 60; // Convert back to minutes
                }
            }

            const progress = Math.round((completedTime / totalRecipeTime) * 100);
            return Math.min(100, Math.max(0, progress)); // Clamp between 0-100
        }

        function calculateRemainingTime(bread) {
            const totalRecipeTime = calculateTotalRecipeTime();
            if (totalRecipeTime === 0) {
                return 0;
            }

            // Calculate time already completed (all steps before current)
            let completedTime = 0;
            for (let i = 0; i < bread.currentStep; i++) {
                const step = recipeSteps[i];
                if (step.timer && step.timer.duration) {
                    completedTime += step.timer.duration;
                }
            }

            // Add time from current step's timer if it exists
            const currentStep = recipeSteps[bread.currentStep];
            if (currentStep && currentStep.timer && currentStep.timer.duration) {
                const timerId = `timer-${bread.currentStep}`;
                const timer = bread.timers[timerId];

                if (timer) {
                    const remaining = getTimerRemaining(timer);
                    const elapsed = currentStep.timer.duration * 60 - remaining; // Convert to seconds
                    completedTime += elapsed / 60; // Convert back to minutes
                }
            }

            return Math.round(totalRecipeTime - completedTime);
        }

        function formatMinutesToTime(minutes) {
            if (minutes < 60) {
                return `${minutes} ×“×§'`;
            }
            const hours = Math.floor(minutes / 60);
            const mins = minutes % 60;
            if (mins === 0) {
                return `${hours} ×©×¢'`;
            }
            return `${hours} ×©×¢' ${mins} ×“×§'`;
        }

        function updateActiveTimersIndicator() {
            const indicator = document.getElementById('activeTimersIndicator');
            const globalTimersList = document.getElementById('globalTimersList');

            if (!indicator || !globalTimersList) return;

            let activeCount = 0;

            // Count active timers for the indicator
            Object.values(breads).forEach(bread => {
                Object.entries(bread.timers).forEach(([timerId, timer]) => {
                    if (timer.running) {
                        activeCount++;
                    }
                });
            });

            // Update indicator
            if (activeCount > 0) {
                indicator.innerHTML = `<span class="timer-pulse"></span> ${activeCount} ×˜×™×™××¨${activeCount > 1 ? '×™×' : ''} ×¤×¢×™×œ${activeCount > 1 ? '×™×' : ''}`;
                indicator.style.display = 'flex';
            } else {
                indicator.style.display = 'none';
            }

            // Build HTML for ALL breads (not just those with timers)
            let breadsHTML = '';
            Object.values(breads).forEach(bread => {
                const isActive = bread.id === currentBreadId;
                const progress = calculateTimeBasedProgress(bread);
                const stepName = recipeSteps[bread.currentStep]?.title || '';
                const totalRecipeTime = calculateTotalRecipeTime();
                const remainingTime = calculateRemainingTime(bread);

                // Get active timer info
                let timerInfo = '';
                Object.entries(bread.timers).forEach(([timerId, timer]) => {
                    if (timer.running) {
                        const remaining = getTimerRemaining(timer);
                        timerInfo = `<div class="global-timer-time">â±ï¸ ${formatTime(remaining)}</div>`;
                    }
                });

                // Build time info string
                let timeInfo = '';
                if (totalRecipeTime > 0) {
                    timeInfo = ` â€¢ ${formatMinutesToTime(remainingTime)} × ×•×ª×¨×•`;
                }

                breadsHTML += `
                    <div class="global-timer-item ${isActive ? 'active' : ''}" data-bread-id="${bread.id}" onclick="switchBread('${bread.id}')">
                        <div style="flex: 1;">
                            <div class="global-timer-label">
                                <span style="font-weight: 600;">${bread.name}</span>
                            </div>
                            <div style="font-size: 0.85em; color: rgba(255,255,255,0.8); margin-top: 2px;">
                                ${stepName} â€¢ ×©×œ×‘ ${bread.currentStep + 1}/${recipeSteps.length} â€¢ ${progress}%${timeInfo}
                            </div>
                        </div>
                        ${timerInfo}
                        <button class="btn-delete" onclick="event.stopPropagation(); confirmDeleteBread('${bread.id}')" style="margin-right: 8px; padding: 4px 8px; font-size: 1.1em;">
                            ğŸ—‘ï¸
                        </button>
                    </div>
                `;
            });

            globalTimersList.innerHTML = breadsHTML;
        }

        function updateGlobalTimersDisplay() {
            // Update the time displays in real-time without rebuilding the entire HTML
            const globalTimerItems = document.querySelectorAll('.global-timer-item');

            globalTimerItems.forEach(item => {
                const breadId = item.getAttribute('data-bread-id');
                const timerId = item.getAttribute('data-timer-id');

                if (breadId && timerId && breads[breadId] && breads[breadId].timers[timerId]) {
                    const timer = breads[breadId].timers[timerId];
                    if (timer.running) {
                        const remaining = getTimerRemaining(timer);
                        const timeDisplay = item.querySelector('.global-timer-time');
                        if (timeDisplay) {
                            timeDisplay.textContent = formatTime(remaining);
                        }
                    }
                }
            });
        }

        function getTimerRemaining(timer) {
            if (!timer.running) {
                return timer.remaining;
            }
            const now = Date.now();
            const elapsed = Math.floor((now - timer.startTime) / 1000);
            return Math.max(0, timer.remaining - elapsed);
        }



        function renderStep() {
            const bread = getCurrentBread();
            if (!bread) {
                // If no bread is selected, show a welcome message
                document.getElementById('stepContainer').innerHTML = `
                    <div class="step-card" style="text-align: center; padding: 40px 20px;">
                        <div style="font-size: 4em; margin-bottom: 20px;">ğŸ</div>
                        <h2 style="color: #5d4037; margin-bottom: 15px;">×‘×¨×•×›×™× ×”×‘××™×!</h2>
                        <p style="font-size: 1.1em; color: #666; margin-bottom: 20px;">
                            ×”×ª×—×œ ×œ×—× ×—×“×© ×›×“×™ ×œ×”×ª×—×™×œ ×‘××¤×™×™×”
                        </p>
                        <button class="btn btn-success" onclick="createNewBread()" style="font-size: 1.1em; padding: 12px 24px;">
                            â• ×”×ª×—×œ ×œ×—× ×—×“×©
                        </button>
                    </div>
                `;
                return;
            }

            const currentStep = bread.currentStep;
            const step = recipeSteps[currentStep];
            const container = document.getElementById('stepContainer');
            const progressBar = document.getElementById('progressBar');

            progressBar.style.width = calculateTimeBasedProgress(bread) + '%';

            updateActiveTimersIndicator();

            if (currentStep >= recipeSteps.length) {
                container.innerHTML = `
                    <div class="step-card completion">
                        <div class="completion-icon">ğŸ‰</div>
                        <h2>×›×œ ×”×›×‘×•×“!</h2>
                        <p style="font-size: 1.2em; color: #555; margin: 20px 0;">××¤×™×ª× ×›×™×›×¨ ×œ×—× ××—××¦×ª ××“×”×™××”!</p>
                        <p style="color: #777;">×ª×”× ×• ××”×œ×—× ×”×‘×™×ª×™ ×©×œ×›×. ×›×›×œ ×©×ª×ª×¨×’×œ×• ×™×•×ª×¨, ×›×š ×–×” ×™×”×™×” ×˜×•×‘ ×™×•×ª×¨!</p>
                        <button class="btn btn-success" onclick="confirmDeleteBread('${currentBreadId}')" style="margin-top: 30px;">
                            âœ… ×¡×™×™××ª×™ - ××—×§ ×œ×—× ×–×”
                        </button>
                    </div>
                `;
                return;
            }

            let html = `
                <div class="step-card">
                    <div class="step-header">
                        <div class="step-number">${currentStep + 1}</div>
                        <div class="step-title">${step.title}</div>
                    </div>

                    <div class="step-content">
                        ${step.content}
                    </div>
            `;

            if (step.ingredients) {
                html += `
                    <div class="ingredients">
                        <h4>ğŸ“ ××¦×¨×›×™×:</h4>
                        ${step.ingredients.map(ing => `<div class="ingredient-item">â€¢ ${ing}</div>`).join('')}
                    </div>
                `;
            }

            if (step.temperature) {
                html += `<div class="temperature">ğŸŒ¡ï¸ ${step.temperature}</div>`;
            }

            if (step.tips) {
                html += `
                    <div class="tips">
                        <strong>ğŸ’¡ Tip:</strong> ${step.tips}
                    </div>
                `;
            }

            if (step.timer) {
                const timerId = `timer-${currentStep}`;
                const timerState = bread.timers[timerId] || { remaining: step.timer.duration * 60, running: false, startTime: null };
                const displayTime = getTimerRemaining(timerState);
                const domTimerId = `${bread.id}-${timerId}`; // Unique DOM ID per bread

                html += `
                    <div class="timer-section">
                        <div class="timer-label">${step.timer.label}</div>
                        <div class="timer-display" id="${domTimerId}-display" onclick="editTimer('${timerId}')" title="×œ×—×¥ ×œ×¢×¨×™×›×”">
                            ${formatTime(displayTime)}
                        </div>
                        <div class="timer-adjust">
                            <button class="btn-adjust" onclick="adjustTimer('${timerId}', -300)">-5 ×“×§×³</button>
                            <button class="btn-adjust" onclick="adjustTimer('${timerId}', -60)">-1 ×“×§×³</button>
                            <button class="btn-adjust" onclick="adjustTimer('${timerId}', 60)">+1 ×“×§×³</button>
                            <button class="btn-adjust" onclick="adjustTimer('${timerId}', 300)">+5 ×“×§×³</button>
                        </div>
                        <div class="timer-buttons">
                            <button class="btn btn-primary" onclick="toggleTimer('${timerId}', ${step.timer.duration * 60})">
                                <span id="${domTimerId}-btn-text">${timerState.running ? 'â¸ï¸ ×”×©×”×”' : 'â–¶ï¸ ×”×ª×—×œ'}</span>
                            </button>
                            <button class="btn btn-primary" onclick="resetTimer('${timerId}', ${step.timer.duration * 60})">
                                ğŸ”„ ××¤×¡
                            </button>
                        </div>
                    </div>
                `;
            }

            html += `
                    <div class="navigation">
                        ${currentStep > 0 ? '<button class="btn btn-back" onclick="previousStep()">â†’ ×”×§×•×“×</button>' : ''}
                        <button class="btn btn-next" onclick="nextStep()">
                            ${currentStep < recipeSteps.length - 1 ? '×”×‘× â†' : '×¡×™×•×! ğŸ‰'}
                        </button>
                    </div>
                </div>
            `;

            container.innerHTML = html;
        }

        function formatTime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;

            if (hours > 0) {
                return `${hours}:${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
            }
            return `${minutes}:${String(secs).padStart(2, '0')}`;
        }

        function toggleTimer(timerId, initialDuration) {
            const bread = getCurrentBread();
            if (!bread) return;

            if (!bread.timers[timerId]) {
                bread.timers[timerId] = { remaining: initialDuration, running: false, startTime: null };
            }

            const timer = bread.timers[timerId];

            if (timer.running) {
                // Pause: calculate actual remaining time
                const elapsed = Math.floor((Date.now() - timer.startTime) / 1000);
                timer.remaining = Math.max(0, timer.remaining - elapsed);
                timer.running = false;
                timer.startTime = null;
            } else {
                // Check if another timer is already running for this bread
                const hasRunningTimer = Object.entries(bread.timers).some(([id, t]) => {
                    return id !== timerId && t.running;
                });

                if (hasRunningTimer) {
                    alert('×›×‘×¨ ×™×© ×˜×™×™××¨ ×¤×¢×™×œ ×œ×œ×—× ×–×”. ×¢×¦×•×¨ ××• ×”××ª×Ÿ ×œ×¡×™×•× ×”×˜×™×™××¨ ×”×§×™×™× ×œ×¤× ×™ ×”×¤×¢×œ×ª ×˜×™×™××¨ ×—×“×©.');
                    return;
                }

                // Start: record start time
                timer.running = true;
                timer.startTime = Date.now();

                // Initialize audio on first timer start (required for iOS/Android)
                initializeAudio();
            }

            const domTimerId = `${bread.id}-${timerId}`;
            const btnText = document.getElementById(`${domTimerId}-btn-text`);
            if (btnText) {
                btnText.textContent = timer.running ? 'â¸ï¸ ×”×©×”×”' : 'â–¶ï¸ ×”×ª×—×œ';
            }

            updateActiveTimersIndicator();
            saveProgress();
        }

        function resetTimer(timerId, initialDuration) {
            const bread = getCurrentBread();
            if (!bread) return;

            bread.timers[timerId] = { remaining: initialDuration, running: false, startTime: null };
            const domTimerId = `${bread.id}-${timerId}`;
            const display = document.getElementById(`${domTimerId}-display`);
            if (display) {
                display.textContent = formatTime(initialDuration);
            }
            const btnText = document.getElementById(`${domTimerId}-btn-text`);
            if (btnText) {
                btnText.textContent = 'â–¶ï¸ ×”×ª×—×œ';
            }
            updateActiveTimersIndicator();
            saveProgress();
        }

        function ensureTimerExists(timerId, initialDuration) {
            const bread = getCurrentBread();
            if (!bread) return null;

            if (!bread.timers[timerId]) {
                bread.timers[timerId] = {
                    remaining: initialDuration,
                    running: false,
                    startTime: null
                };
            }
            return bread.timers[timerId];
        }

        function adjustTimer(timerId, seconds) {
            const bread = getCurrentBread();
            if (!bread) return;

            // Get initial duration from the timer display's data attribute or calculate from current step
            const currentStep = bread.currentStep;
            const step = recipeSteps[currentStep];
            const initialDuration = step.timer ? step.timer.duration * 60 : 0;

            const timer = ensureTimerExists(timerId, initialDuration);
            if (!timer) return;

            if (timer.running) {
                // If running, adjust the remaining time by modifying startTime
                const currentRemaining = getTimerRemaining(timer);
                const newRemaining = Math.max(0, currentRemaining + seconds);
                timer.remaining = newRemaining;
                timer.startTime = Date.now();
            } else {
                // If paused, just adjust the remaining time
                timer.remaining = Math.max(0, timer.remaining + seconds);
            }

            const domTimerId = `${bread.id}-${timerId}`;
            const display = document.getElementById(`${domTimerId}-display`);
            if (display) {
                display.textContent = formatTime(timer.running ? getTimerRemaining(timer) : timer.remaining);
            }

            saveProgress();
        }

        function editTimer(timerId) {
            const bread = getCurrentBread();
            if (!bread) return;

            // Get initial duration from current step
            const currentStep = bread.currentStep;
            const step = recipeSteps[currentStep];
            const initialDuration = step.timer ? step.timer.duration * 60 : 0;

            const timer = ensureTimerExists(timerId, initialDuration);
            if (!timer) return;

            if (timer.running) {
                alert('×¢×¦×•×¨ ××ª ×”×˜×™×™××¨ ×œ×¤× ×™ ×¢×¨×™×›×”');
                return; // Don't allow editing while running
            }

            const domTimerId = `${bread.id}-${timerId}`;
            const display = document.getElementById(`${domTimerId}-display`);
            if (!display) return;

            const currentTime = timer.remaining;
            const hours = Math.floor(currentTime / 3600);
            const minutes = Math.floor((currentTime % 3600) / 60);
            const seconds = currentTime % 60;

            const timeString = hours > 0
                ? `${hours}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`
                : `${minutes}:${String(seconds).padStart(2, '0')}`;

            const input = prompt('×¢×¨×•×š ×–××Ÿ (×¤×•×¨××˜: MM:SS ××• HH:MM:SS):', timeString);

            if (input) {
                const parts = input.split(':').map(p => parseInt(p.trim()));
                let newSeconds = 0;

                if (parts.length === 2) {
                    // MM:SS
                    newSeconds = parts[0] * 60 + parts[1];
                } else if (parts.length === 3) {
                    // HH:MM:SS
                    newSeconds = parts[0] * 3600 + parts[1] * 60 + parts[2];
                }

                if (newSeconds > 0 && !isNaN(newSeconds)) {
                    timer.remaining = newSeconds;
                    display.textContent = formatTime(newSeconds);
                    saveProgress();
                } else {
                    alert('×¤×•×¨××˜ ×œ× ×ª×§×™×Ÿ. ×”×©×ª××© ×‘-MM:SS ××• HH:MM:SS');
                }
            }
        }

        function updateAllTimers() {
            // Update all running timers across all breads
            let needsUpdate = false;
            Object.values(breads).forEach(bread => {
                Object.keys(bread.timers).forEach(timerId => {
                    const timer = bread.timers[timerId];
                    if (timer.running) {
                        const remaining = getTimerRemaining(timer);
                        const domTimerId = `${bread.id}-${timerId}`;
                        const display = document.getElementById(`${domTimerId}-display`);
                        if (display) {
                            display.textContent = formatTime(remaining);
                        }

                        // Check if timer finished
                        if (remaining <= 0) {
                            timer.running = false;
                            timer.remaining = 0;
                            timer.startTime = null;

                            const btnText = document.getElementById(`${domTimerId}-btn-text`);
                            if (btnText) {
                                btnText.textContent = 'â–¶ï¸ ×”×ª×—×œ';
                            }

                            playNotification();
                            showNotification(`â° ×”×˜×™×™××¨ ×”×¡×ª×™×™×! (${bread.name})`);
                            updateActiveTimersIndicator();
                            saveProgress();
                            needsUpdate = true;
                        }
                    }
                });
            });

            // Always update all timer displays in real-time
            updateGlobalTimersDisplay();
            updateStickyBreadSelectorTimers();
            updateActiveTimersIndicator(); // Update sticky header timers in real-time
        }

        function updateStickyBreadSelectorTimers() {
            // Update timer info in sticky bread selector in real-time
            Object.keys(breads).forEach(id => {
                const bread = breads[id];
                const breadItem = document.querySelector(`.sticky-bread-selector .bread-item[data-bread-id="${id}"]`);

                if (breadItem) {
                    let timerInfoElement = breadItem.querySelector('.bread-timer-info');

                    const activeTimers = [];
                    Object.entries(bread.timers).forEach(([timerId, timer]) => {
                        if (timer.running) {
                            const remaining = getTimerRemaining(timer);
                            activeTimers.push(formatTime(remaining));
                        }
                    });

                    if (activeTimers.length > 0) {
                        const timerText = `â±ï¸ ${activeTimers.join(', ')}`;
                        if (timerInfoElement) {
                            // Update existing element
                            timerInfoElement.textContent = timerText;
                            timerInfoElement.style.display = 'block';
                        } else {
                            // Create new element if it doesn't exist
                            const breadItemInfo = breadItem.querySelector('.bread-item-info');
                            if (breadItemInfo) {
                                timerInfoElement = document.createElement('div');
                                timerInfoElement.className = 'bread-timer-info';
                                timerInfoElement.textContent = timerText;
                                breadItemInfo.appendChild(timerInfoElement);
                            }
                        }
                    } else {
                        // Hide timer info if no active timers
                        if (timerInfoElement) {
                            timerInfoElement.style.display = 'none';
                        }
                    }
                }
            });
        }

        function startGlobalTimerUpdate() {
            if (timerUpdateInterval) {
                clearInterval(timerUpdateInterval);
            }
            timerUpdateInterval = setInterval(updateAllTimers, 1000);
        }

        // Audio element for notifications - initialized on first user interaction
        let notificationAudio = null;
        let audioInitialized = false;

        function initializeAudio() {
            if (audioInitialized) return;

            // Create audio element with a simple beep sound (data URI)
            // This is a short beep sound encoded as base64 MP3
            notificationAudio = new Audio('data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4Ljc2LjEwMAAAAAAAAAAAAAAA//tQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAADhAC7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7v/////////////////////////////////////////////////////////////////AAAAOUxhdmM1OC4xMzQAAAAAAAAAAAAAAAAkAAAAAAAAA4S/Vp0NAAAAAAAAAAAAAAAAAAAAAAAAAP/7kGQAD/AAAGkAAAAIAAANIAAAAQAAAaQAAAAgAAA0gAAABExBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7kGQAD/AAAGkAAAAIAAANIAAAAQAAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVQ==');
            notificationAudio.volume = 0.7;
            audioInitialized = true;
        }

        function playNotification() {
            // Initialize audio if not already done
            initializeAudio();

            // Try to play the audio
            if (notificationAudio) {
                // Play 3 beeps
                let beepCount = 0;
                const playBeep = () => {
                    if (beepCount < 3) {
                        notificationAudio.currentTime = 0;
                        notificationAudio.play().catch(err => {
                            console.log('Audio play failed:', err);
                            // Fallback to vibration on mobile if audio fails
                            if ('vibrate' in navigator) {
                                navigator.vibrate([200, 100, 200, 100, 200]);
                            }
                        });
                        beepCount++;
                        setTimeout(playBeep, 400);
                    }
                };
                playBeep();
            } else {
                // Fallback to vibration if audio not available
                if ('vibrate' in navigator) {
                    navigator.vibrate([200, 100, 200, 100, 200]);
                }
            }
        }

        function showNotification(message) {
            // Try browser notification first
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification('×œ×—× ××—××¦×ª', {
                    body: message,
                    icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y="80" font-size="80">ğŸ</text></svg>',
                    tag: 'sourdough-timer',
                    requireInteraction: true
                });
            } else {
                // Fallback to alert
                alert(message);
            }
        }

        function createNewBread() {
            const breadId = 'bread-' + Date.now();
            breadCounter++; // Increment the counter for each new bread
            breads[breadId] = {
                id: breadId,
                name: `×œ×—× #${breadCounter}`,
                currentStep: 0,
                timers: {},
                createdAt: Date.now()
            };
            currentBreadId = breadId;
            saveProgress();
            updateActiveTimersIndicator(); // Update the header bread list
            updateRecipeSelectorVisibility(); // Hide recipe selector when bread is created
            renderStep();
        }

        function switchBread(breadId) {
            currentBreadId = breadId;

            // Check if this bread has a running timer and jump to that step
            const bread = breads[breadId];
            if (bread) {
                // Find the step with a running timer
                for (const [timerId, timer] of Object.entries(bread.timers)) {
                    if (timer.running) {
                        // Extract step index from timerId (format: "timer-3")
                        const stepMatch = timerId.match(/timer-(\d+)/);
                        if (stepMatch) {
                            const stepIndex = parseInt(stepMatch[1]);
                            bread.currentStep = stepIndex;
                            break; // Only one timer can be running, so we can break
                        }
                    }
                }
            }

            saveProgress();
            renderStep();
        }

        function jumpToTimer(breadId, timerId) {
            // Switch to the bread
            currentBreadId = breadId;

            // Extract step index from timerId (format: "timer-3")
            const stepMatch = timerId.match(/timer-(\d+)/);
            if (stepMatch && breads[breadId]) {
                const stepIndex = parseInt(stepMatch[1]);
                breads[breadId].currentStep = stepIndex;
            }

            saveProgress();
            renderStep();
        }

        function viewAllBreads() {
            currentBreadId = null;
            saveProgress();
            renderStep();
        }

        function confirmDeleteBread(breadId) {
            const bread = breads[breadId];
            if (!bread) return;

            const breadName = bread.name;
            const progress = calculateTimeBasedProgress(bread);

            if (confirm(`×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª "${breadName}"?\n\n×”×ª×§×“××•×ª: ${progress}% (×©×œ×‘ ${bread.currentStep + 1}/${recipeSteps.length})\n\n×¤×¢×•×œ×” ×–×• ×œ× × ×™×ª× ×ª ×œ×‘×™×˜×•×œ!`)) {
                deleteBread(breadId);
            }
        }

        function deleteBread(breadId) {
            delete breads[breadId];

            // If we deleted the current bread, clear selection
            if (currentBreadId === breadId) {
                currentBreadId = null;
            }

            // If no breads left, reset the counter
            if (Object.keys(breads).length === 0) {
                breadCounter = 0;
            }

            saveProgress();
            updateActiveTimersIndicator(); // Update the header bread list
            updateRecipeSelectorVisibility(); // Show recipe selector when all breads are deleted
            renderStep();
        }

        function nextStep() {
            const bread = getCurrentBread();
            if (!bread) return;
            bread.currentStep++;
            saveProgress();
            window.scrollTo(0, 0);
            renderStep();
        }

        function previousStep() {
            const bread = getCurrentBread();
            if (!bread) return;
            if (bread.currentStep > 0) {
                bread.currentStep--;
                saveProgress();
                window.scrollTo(0, 0);
                renderStep();
            }
        }

        function saveProgress() {
            localStorage.setItem('sourdoughProgress', JSON.stringify({
                breads,
                currentBreadId,
                breadCounter
            }));
        }

        function loadProgress() {
            const saved = localStorage.getItem('sourdoughProgress');
            if (saved) {
                try {
                    const data = JSON.parse(saved);

                    // Load breads
                    if (data.breads) {
                        breads = data.breads;
                        currentBreadId = data.currentBreadId || null;
                        breadCounter = data.breadCounter || Object.keys(data.breads).length;
                    } else if (data.currentStep !== undefined) {
                        // Migrate old single-bread format
                        const breadId = 'bread-' + Date.now();
                        breads[breadId] = {
                            id: breadId,
                            name: '×œ×—× #1',
                            currentStep: data.currentStep || 0,
                            timers: data.timers || {},
                            createdAt: Date.now()
                        };
                        currentBreadId = breadId;
                        breadCounter = 1;
                    }
                } catch (e) {
                    console.error('Failed to load progress:', e);
                }
            }

            // Don't auto-create bread - let user create when ready
        }

        async function loadRecipeFromURL() {
            const params = new URLSearchParams(window.location.search);
            const recipeUrl = params.get('recipe');

            if (recipeUrl) {
                await loadRecipeFromUrlString(recipeUrl);
            }
        }

        async function loadRecipeFromUrlString(url) {
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const recipe = await response.json();

                // Validate recipe structure
                if (!Array.isArray(recipe) || recipe.length === 0) {
                    throw new Error('×”××ª×›×•×Ÿ ×—×™×™×‘ ×œ×”×™×•×ª ××¢×¨×š ×¢× ×œ×¤×—×•×ª ×©×œ×‘ ××—×“');
                }

                // Validate each step has required fields
                for (let i = 0; i < recipe.length; i++) {
                    const step = recipe[i];
                    if (!step.title || !step.content) {
                        throw new Error(`×©×œ×‘ ${i + 1} ×—×¡×¨ ×©×“×•×ª × ×“×¨×©×™× (title, content)`);
                    }
                }

                recipeSteps = recipe;
                console.log('Loaded custom recipe from:', url);
                alert(`âœ… ×”××ª×›×•×Ÿ × ×˜×¢×Ÿ ×‘×”×¦×œ×—×”!\n\n${recipe.length} ×©×œ×‘×™× ×‘××ª×›×•×Ÿ ×”×—×“×©.`);

                // Reset all breads to use new recipe
                Object.keys(breads).forEach(id => {
                    breads[id].currentStep = 0;
                    breads[id].timers = {};
                });

                saveProgress();
                renderStep();

            } catch (e) {
                console.error('Failed to load recipe from URL:', e);
                alert(`âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×”××ª×›×•×Ÿ:\n\n${e.message}\n\n××©×ª××© ×‘××ª×›×•×Ÿ ×”× ×•×›×—×™.`);
            }
        }

        function toggleRecipeLoader() {
            const section = document.getElementById('recipeLoaderSection');
            if (section) {
                section.style.display = section.style.display === 'none' ? 'block' : 'none';
            }
        }

        function handleRecipeSelection() {
            const selector = document.getElementById('recipeSelector');
            const selectedKey = selector.value;

            // Show preview for the selected recipe
            showRecipePreview(selectedKey);

            // If it's already the current recipe, just show preview
            if (selectedKey === currentRecipeKey) {
                return;
            }

            // Check if there are any breads - if so, don't allow switching
            if (Object.keys(breads).length > 0) {
                alert('âŒ ×œ× × ×™×ª×Ÿ ×œ×”×—×œ×™×£ ××ª×›×•×Ÿ ×›××©×¨ ×™×© ×œ×—××™× ×¤×¢×™×œ×™×!\n\n××—×§ ××ª ×›×œ ×”×œ×—××™× ×œ×¤× ×™ ×”×—×œ×¤×ª ×”××ª×›×•×Ÿ.');
                // Revert selector to current recipe
                selector.value = currentRecipeKey;
                showRecipePreview(currentRecipeKey);
                return;
            }

            // Otherwise, ask to switch
            selectRecipe(selectedKey);
        }

        function showRecipePreview(recipeKey) {
            const recipe = recipeLibrary[recipeKey];
            if (!recipe) return;

            const previewBox = document.getElementById('recipePreviewBox');
            const previewContent = document.getElementById('recipePreviewContent');

            if (!previewBox || !previewContent) return;

            // Calculate total time
            let totalMinutes = 0;
            recipe.steps.forEach(step => {
                if (step.timer && step.timer.duration) {
                    totalMinutes += step.timer.duration;
                }
            });

            // Get ingredients from first step
            const ingredients = recipe.steps[0]?.ingredients || [];
            const ingredientsText = ingredients.length > 0
                ? ingredients.slice(0, 3).join(', ') + (ingredients.length > 3 ? '...' : '')
                : '×œ× ×¦×•×™×Ÿ';

            // Count steps with timers
            const timerSteps = recipe.steps.filter(s => s.timer).length;

            // Build preview HTML
            previewContent.innerHTML = `
                <div style="margin-bottom: 6px;">
                    <strong>ğŸ“– ×©×:</strong> ${recipe.name}
                </div>
                <div style="margin-bottom: 6px;">
                    <strong>ğŸ“ ×ª×™××•×¨:</strong> ${recipe.description}
                </div>
                <div style="margin-bottom: 6px;">
                    <strong>â±ï¸ ×–××Ÿ ×›×•×œ×œ:</strong> ${recipe.totalTime} (${totalMinutes} ×“×§×•×ª)
                </div>
                <div style="margin-bottom: 6px;">
                    <strong>ğŸ“Š ×¨××ª ×§×•×©×™:</strong> ${recipe.difficulty}
                </div>
                <div style="margin-bottom: 6px;">
                    <strong>ğŸ”¢ ××¡×¤×¨ ×©×œ×‘×™×:</strong> ${recipe.steps.length} (${timerSteps} ×¢× ×˜×™×™××¨)
                </div>
                <div style="margin-bottom: 6px;">
                    <strong>ğŸ¥– ××¨×›×™×‘×™× ×¢×™×§×¨×™×™×:</strong> ${ingredientsText}
                </div>
            `;

            previewBox.style.display = 'block';
        }

        function previewRecipeDetails() {
            const selector = document.getElementById('recipeSelector');
            const selectedKey = selector.value;
            const recipe = recipeLibrary[selectedKey];

            if (!recipe) return;

            // Create a modal dialog with all steps
            const modal = document.createElement('div');
            modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 10000; padding: 20px;';

            const content = document.createElement('div');
            content.style.cssText = 'background: white; border-radius: 8px; padding: 20px; max-width: 700px; max-height: 80vh; overflow-y: auto;';

            // Build steps HTML
            let stepsHTML = '';
            recipe.steps.forEach((step, index) => {
                const timerText = step.timer
                    ? `â±ï¸ ${step.timer.duration} ×“×§×•×ª - ${step.timer.label}`
                    : 'â±ï¸ ×œ×œ× ×˜×™×™××¨';
                const tempText = step.temperature ? `ğŸŒ¡ï¸ ${step.temperature}` : '';
                const ingredientsHTML = step.ingredients
                    ? `<div style="background: #fff3cd; padding: 8px; border-radius: 4px; margin-top: 6px;">
                        <strong>ğŸ¥– ××¨×›×™×‘×™×:</strong><br>
                        ${step.ingredients.map(ing => `â€¢ ${ing}`).join('<br>')}
                       </div>`
                    : '';

                stepsHTML += `
                    <div style="border-bottom: 1px solid #ddd; padding: 12px 0;">
                        <div style="font-weight: 600; color: #8b4513; margin-bottom: 4px;">
                            ${index + 1}. ${step.title}
                        </div>
                        <div style="font-size: 0.85em; color: #666; margin-bottom: 4px;">
                            ${step.content}
                        </div>
                        ${ingredientsHTML}
                        <div style="font-size: 0.8em; color: #999; margin-top: 4px;">
                            ${timerText} ${tempText}
                        </div>
                        ${step.tips ? `<div style="font-size: 0.8em; color: #4caf50; margin-top: 4px;">ğŸ’¡ ${step.tips}</div>` : ''}
                    </div>
                `;
            });

            content.innerHTML = `
                <h3 style="margin-top: 0; color: #8b4513; text-align: center;">${recipe.name}</h3>
                <div style="text-align: center; color: #666; font-size: 0.9em; margin-bottom: 15px;">
                    ${recipe.description}<br>
                    <strong>â±ï¸ ${recipe.totalTime}</strong> â€¢ <strong>ğŸ“Š ${recipe.difficulty}</strong> â€¢ <strong>ğŸ”¢ ${recipe.steps.length} ×©×œ×‘×™×</strong>
                </div>
                <div style="max-height: 50vh; overflow-y: auto;">
                    ${stepsHTML}
                </div>
                <button onclick="closeRecipeDetailsModal()" style="width: 100%; background: #666; color: white; border: none; padding: 10px; border-radius: 4px; font-weight: 600; cursor: pointer; margin-top: 15px;">
                    âœ–ï¸ ×¡×’×•×¨
                </button>
            `;

            modal.appendChild(content);
            modal.id = 'recipeDetailsModal';
            document.body.appendChild(modal);

            // Close on background click
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeRecipeDetailsModal();
                }
            });
        }

        function closeRecipeDetailsModal() {
            const modal = document.getElementById('recipeDetailsModal');
            if (modal) {
                modal.remove();
            }
        }

        function updateRecipeSelectorVisibility() {
            const recipeSelectorSection = document.getElementById('recipeSelectorSection');
            if (!recipeSelectorSection) return;

            // Hide recipe selector if there are any active breads
            if (Object.keys(breads).length > 0) {
                recipeSelectorSection.style.display = 'none';
            } else {
                recipeSelectorSection.style.display = 'block';
            }
        }

        function selectRecipe(recipeKey) {
            if (!recipeLibrary[recipeKey]) {
                alert('âŒ ××ª×›×•×Ÿ ×œ× × ××¦×!');
                return;
            }

            const recipe = recipeLibrary[recipeKey];
            const confirmMsg = `×”×× ×œ×˜×¢×•×Ÿ ××ª ×”××ª×›×•×Ÿ "${recipe.name}"?\n\n${recipe.description}\n×–××Ÿ ×›×•×œ×œ: ${recipe.totalTime}\n×¨××ª ×§×•×©×™: ${recipe.difficulty}\n\n×›×œ ×”×œ×—××™× ×”×§×™×™××™× ×™××•×¤×¡×•.`;

            if (confirm(confirmMsg)) {
                currentRecipeKey = recipeKey;
                recipeSteps = recipe.steps;
                breads = {};
                currentBreadId = null;
                breadCounter = 0;

                // Save selected recipe
                localStorage.setItem('selectedRecipe', recipeKey);

                // Update the selector to match
                const selector = document.getElementById('recipeSelector');
                if (selector) {
                    selector.value = recipeKey;
                }

                // Hide the recipe loader
                const section = document.getElementById('recipeLoaderSection');
                if (section) {
                    section.style.display = 'none';
                }

                saveProgress();
                renderStep();
                updateActiveTimersIndicator();

                alert(`âœ… ×”××ª×›×•×Ÿ "${recipe.name}" × ×˜×¢×Ÿ ×‘×”×¦×œ×—×”!`);
            } else {
                // User cancelled - revert selector to current recipe
                const selector = document.getElementById('recipeSelector');
                if (selector) {
                    selector.value = currentRecipeKey;
                }
            }
        }

        function resetToDefaultRecipe() {
            selectRecipe('sourdough');
        }

        function showAIPrompt() {
            const prompt = `Create a bread recipe in the following JSON format. The recipe should be detailed, step-by-step, and include timers for each waiting period.

Requirements:
1. Recipe must be in Hebrew (right-to-left)
2. Each step should have:
   - title: Short step name (e.g., "×¢×¨×‘×•×‘ ××¨×›×™×‘×™×", "×§×™×¤×•×œ ×¨××©×•×Ÿ")
   - content: Detailed instructions for this step
   - ingredients: Array of ingredients with amounts (ONLY in first step, null for others)
   - timer: {duration: minutes, label: "description"} or null if no waiting
   - temperature: Temperature info as string or null
   - tips: Helpful tips or null
3. Include ALL steps from start to finish: mixing, resting, folding, shaping, proofing, baking, cooling
4. Timer durations should be realistic (in minutes)
5. Maximum 20 steps

Return ONLY valid JSON array in this format:
[
    {
        "title": "Step name in Hebrew",
        "content": "Detailed instructions in Hebrew",
        "ingredients": ["ingredient 1 with amount", "ingredient 2"] or null,
        "timer": {"duration": 30, "label": "Timer label in Hebrew"} or null,
        "temperature": "Temperature info in Hebrew" or null,
        "tips": "Helpful tips in Hebrew" or null
    },
    // ... more steps
]

IMPORTANT: Return ONLY the JSON array, no explanations or markdown code blocks.

Example request: "Create a recipe for whole wheat sandwich bread"`;

            // Create a modal dialog
            const modal = document.createElement('div');
            modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 10000; padding: 20px;';

            const content = document.createElement('div');
            content.style.cssText = 'background: white; border-radius: 8px; padding: 20px; max-width: 600px; max-height: 80vh; overflow-y: auto; direction: ltr;';

            content.innerHTML = `
                <h3 style="margin-top: 0; color: #333; text-align: center;">ğŸ¤– AI Prompt for Creating New Recipes</h3>
                <p style="color: #666; font-size: 0.9em; text-align: center; margin-bottom: 15px;">
                    Copy this prompt and paste it into ChatGPT, Claude, or any AI.<br>
                    Then paste the AI's JSON output into the <strong>ğŸ“ Text tab</strong> of the recipe loader.
                </p>
                <textarea id="promptText" readonly style="width: 100%; min-height: 300px; padding: 10px; border: 2px solid #9c27b0; border-radius: 4px; font-family: monospace; font-size: 0.85em; resize: vertical; direction: ltr; text-align: left;">${prompt}</textarea>
                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <button onclick="copyPromptToClipboard()" style="flex: 1; background: #9c27b0; color: white; border: none; padding: 10px; border-radius: 4px; font-weight: 600; cursor: pointer;">
                        ğŸ“‹ ×”×¢×ª×§ ×œ×–×™×›×¨×•×Ÿ
                    </button>
                    <button onclick="closeAIPromptModal()" style="flex: 1; background: #666; color: white; border: none; padding: 10px; border-radius: 4px; font-weight: 600; cursor: pointer;">
                        âœ–ï¸ ×¡×’×•×¨
                    </button>
                </div>
            `;

            modal.appendChild(content);
            modal.id = 'aiPromptModal';
            document.body.appendChild(modal);

            // Close on background click
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeAIPromptModal();
                }
            });
        }

        function copyPromptToClipboard() {
            const textarea = document.getElementById('promptText');
            textarea.select();
            textarea.setSelectionRange(0, 99999); // For mobile devices

            try {
                document.execCommand('copy');
                alert('âœ… ×”×¤×¨×•××¤×˜ ×”×•×¢×ª×§ ×œ×–×™×›×¨×•×Ÿ!\n\n×”×“×‘×§ ××•×ª×• ×‘-ChatGPT, Claude, ××• ×›×œ AI ××—×¨.\n××—×¨ ×›×š ×”×“×‘×§ ××ª ×”×ª×©×•×‘×” ×‘×œ×©×•× ×™×ª "ğŸ“ ×˜×§×¡×˜" ×©×œ ×˜×¢×™× ×ª ×”××ª×›×•×Ÿ.');
            } catch (err) {
                // Fallback for modern browsers
                navigator.clipboard.writeText(textarea.value).then(() => {
                    alert('âœ… ×”×¤×¨×•××¤×˜ ×”×•×¢×ª×§ ×œ×–×™×›×¨×•×Ÿ!\n\n×”×“×‘×§ ××•×ª×• ×‘-ChatGPT, Claude, ××• ×›×œ AI ××—×¨.\n××—×¨ ×›×š ×”×“×‘×§ ××ª ×”×ª×©×•×‘×” ×‘×œ×©×•× ×™×ª "ğŸ“ ×˜×§×¡×˜" ×©×œ ×˜×¢×™× ×ª ×”××ª×›×•×Ÿ.');
                }).catch(() => {
                    alert('âŒ ×œ× ×”×¦×œ×—×ª×™ ×œ×”×¢×ª×™×§. ×× × ×‘×—×¨ ××ª ×”×˜×§×¡×˜ ×•×”×¢×ª×§ ×™×“× ×™×ª (Ctrl+C).');
                });
            }
        }

        function closeAIPromptModal() {
            const modal = document.getElementById('aiPromptModal');
            if (modal) {
                modal.remove();
            }
        }

        function parseRecipeText() {
            const textarea = document.getElementById('recipeTextInput');
            const text = textarea ? textarea.value.trim() : '';

            if (!text) {
                alert('×× × ×”×“×‘×§ ×˜×§×¡×˜ ××ª×›×•×Ÿ');
                return;
            }

            try {
                // Parse the recipe text into steps
                const parsedRecipe = parseRecipeFromText(text);

                if (!parsedRecipe || parsedRecipe.length === 0) {
                    alert('×œ× ×”×¦×œ×—×ª×™ ×œ×¤×¨×§ ××ª ×”××ª×›×•×Ÿ. × ×¡×” ×œ×•×•×“× ×©×”××ª×›×•×Ÿ ×›×•×œ×œ ×©×œ×‘×™× ×××•×¡×¤×¨×™× ××• ×¨×©×™××” ×‘×¨×•×¨×”.');
                    return;
                }

                // Set the parsed recipe as the current recipe
                recipeSteps = parsedRecipe;

                // Reset all breads to use the new recipe
                const confirmReset = confirm(`×”××ª×›×•×Ÿ ×¤×•×¨×§ ×‘×”×¦×œ×—×” ×œ-${parsedRecipe.length} ×©×œ×‘×™×!\n\n×”×× ×œ××¤×¡ ××ª ×›×œ ×”×œ×—××™× ×”×§×™×™××™× ×•×œ×”×ª×—×™×œ ××—×“×© ×¢× ×”××ª×›×•×Ÿ ×”×—×“×©?`);

                if (confirmReset) {
                    breads = {};
                    currentBreadId = null;
                    breadCounter = 0;
                    createNewBread();
                }

                // Hide the recipe loader
                const section = document.getElementById('recipeLoaderSection');
                if (section) {
                    section.style.display = 'none';
                }

                // Clear the textarea
                textarea.value = '';

                saveProgress();
                renderStep();

                alert(`âœ… ×”××ª×›×•×Ÿ × ×˜×¢×Ÿ ×‘×”×¦×œ×—×”!\n\n××¡×¤×¨ ×©×œ×‘×™×: ${parsedRecipe.length}`);

            } catch (e) {
                console.error('Failed to parse recipe:', e);
                alert(`âŒ ×©×’×™××” ×‘×¤×™×¨×•×§ ×”××ª×›×•×Ÿ:\n\n${e.message}`);
            }
        }

        function parseRecipeFromText(text) {
            const lines = text.split('\n').map(line => line.trim()).filter(line => line.length > 0);
            const steps = [];
            let currentStep = null;
            let ingredients = [];
            let inIngredientsSection = false;
            let inStepsSection = false;

            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];

                // Check if this is an ingredients section header
                if (line.match(/^(××¨×›×™×‘×™×|×¨×›×™×‘×™×|ingredients)[:ï¼š]?$/i)) {
                    inIngredientsSection = true;
                    inStepsSection = false;
                    continue;
                }

                // Check if this is a steps section header
                if (line.match(/^(×©×œ×‘×™×|×”×•×¨××•×ª|×”×›× ×”|××•×¤×Ÿ ×”×”×›× ×”|steps|instructions|directions|method)[:ï¼š]?$/i)) {
                    inIngredientsSection = false;
                    inStepsSection = true;
                    continue;
                }

                // Parse ingredients (lines starting with - or â€¢) ONLY in ingredients section
                if (inIngredientsSection && line.match(/^[-â€¢*]\s/)) {
                    ingredients.push(line.replace(/^[-â€¢*]\s+/, ''));
                    continue;
                }

                // Parse numbered steps ONLY if we're in steps section or found a clear step pattern
                // Must be: number followed by . or ) and then at least 10 characters
                const stepMatch = line.match(/^(\d+)[\.\)]\s+(.{10,})$/);
                if (stepMatch && (inStepsSection || parseInt(stepMatch[1]) <= 20)) {
                    const stepNum = parseInt(stepMatch[1]);

                    // Only accept sequential steps (no jumps > 2)
                    if (steps.length > 0 && stepNum > steps.length + 2) {
                        // This is probably not a recipe step, skip it
                        continue;
                    }

                    // Save previous step
                    if (currentStep) {
                        steps.push(currentStep);
                    }

                    // Start new step
                    const stepContent = stepMatch[2];
                    currentStep = {
                        title: extractTitle(stepContent),
                        content: stepContent,
                        ingredients: steps.length === 0 && ingredients.length > 0 ? ingredients : null,
                        timer: extractTimer(stepContent),
                        temperature: extractTemperature(stepContent),
                        tips: null
                    };
                    inIngredientsSection = false;
                    continue;
                }

                // If we're in a step and this is a continuation line (not too short)
                if (currentStep && !inIngredientsSection && line.length > 5) {
                    currentStep.content += ' ' + line;
                }
            }

            // Add the last step
            if (currentStep) {
                steps.push(currentStep);
            }

            // Sanity check: if we got too many steps, something went wrong
            if (steps.length > 50) {
                throw new Error(`× ××¦××• ×™×•×ª×¨ ××“×™ ×©×œ×‘×™× (${steps.length}). ×× × ×•×“× ×©×”××ª×›×•×Ÿ ××›×™×œ ×¨×§ ××ª ×”×©×œ×‘×™× ×”×××•×¡×¤×¨×™×, ×œ×œ× ×˜×§×¡×˜ × ×•×¡×£.`);
            }

            // If no numbered steps found, try to split by double line breaks (paragraphs)
            if (steps.length === 0) {
                const paragraphs = text.split(/\n\n+/).filter(p => p.trim().length > 30);

                if (paragraphs.length > 50) {
                    throw new Error('×œ× × ××¦××• ×©×œ×‘×™× ×××•×¡×¤×¨×™× ×‘××ª×›×•×Ÿ. ×× × ×•×“× ×©×”××ª×›×•×Ÿ ×›×•×œ×œ ×©×œ×‘×™× ×›××• "1. ..." ××• "2. ..."');
                }

                paragraphs.forEach((para, index) => {
                    steps.push({
                        title: `×©×œ×‘ ${index + 1}`,
                        content: para.trim(),
                        ingredients: index === 0 && ingredients.length > 0 ? ingredients : null,
                        timer: extractTimer(para),
                        temperature: extractTemperature(para),
                        tips: null
                    });
                });
            }

            return steps;
        }

        function extractTitle(text) {
            // Try to extract a title from the first sentence or first few words
            const firstSentence = text.split(/[.!?]/)[0];
            if (firstSentence.length < 50) {
                return firstSentence;
            }
            // Otherwise use first 5 words
            const words = text.split(' ').slice(0, 5).join(' ');
            return words + '...';
        }

        function extractTimer(text) {
            // Look for time patterns like "30 ×“×§×•×ª", "2 ×©×¢×•×ª", "30 minutes", "2 hours"
            const timePatterns = [
                /(\d+)\s*(×“×§×•×ª|×“×§×”|minutes?|mins?)/i,
                /(\d+)\s*(×©×¢×•×ª|×©×¢×”|hours?|hrs?)/i,
                /(\d+)-(\d+)\s*(×“×§×•×ª|×“×§×”|minutes?|mins?)/i,
                /(\d+)-(\d+)\s*(×©×¢×•×ª|×©×¢×”|hours?|hrs?)/i
            ];

            for (const pattern of timePatterns) {
                const match = text.match(pattern);
                if (match) {
                    let duration = parseInt(match[1]);
                    const unit = match[2] || match[3];

                    // Convert hours to minutes
                    if (unit.match(/×©×¢×•×ª|×©×¢×”|hours?|hrs?/i)) {
                        duration *= 60;
                    }

                    // If it's a range, use the average
                    if (match[2] && !isNaN(parseInt(match[2]))) {
                        duration = Math.round((parseInt(match[1]) + parseInt(match[2])) / 2);
                    }

                    return {
                        duration: duration,
                        label: match[0]
                    };
                }
            }

            return null;
        }

        function extractTemperature(text) {
            // Look for temperature patterns like "180Â°C", "350Â°F"
            const tempMatch = text.match(/(\d+)\s*Â°?\s*([CF])/i);
            if (tempMatch) {
                return `×ª× ×•×¨: ${tempMatch[1]}Â°${tempMatch[2].toUpperCase()}`;
            }
            return null;
        }

        function loadCustomRecipe() {
            const input = document.getElementById('recipeUrlInput');
            const url = input ? input.value.trim() : '';

            if (!url) {
                alert('×× × ×”×–×Ÿ ×›×ª×•×‘×ª URL ×©×œ ××ª×›×•×Ÿ');
                return;
            }

            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                alert('×›×ª×•×‘×ª ×”-URL ×—×™×™×‘×ª ×œ×”×ª×—×™×œ ×‘-http:// ××• https://');
                return;
            }

            loadRecipeFromUrlString(url);

            // Hide the recipe loader after loading
            const section = document.getElementById('recipeLoaderSection');
            if (section) {
                section.style.display = 'none';
            }
        }

        // Request notification permission
        if ('Notification' in window && Notification.permission === 'default') {
            Notification.requestPermission();
        }

        // Initialize app
        async function initApp() {
            // Set recipe selector to current recipe
            const selector = document.getElementById('recipeSelector');
            if (selector) {
                selector.value = currentRecipeKey;
            }

            await loadRecipeFromURL();
            loadProgress();
            updateRecipeSelectorVisibility(); // Update visibility based on loaded breads
            startGlobalTimerUpdate();
            renderStep();
        }

        initApp();
    </script>
</body>
</html>