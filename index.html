<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#8B4513">
    <title>××“×¨×™×š ×œ××¤×™×™×ª ×œ×—× ××—××¦×ª</title>
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiU291cmRvdWdoIEJyZWFkIEd1aWRlIiwic2hvcnRfbmFtZSI6IlNvdXJkb3VnaCIsInN0YXJ0X3VybCI6Ii8iLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsImJhY2tncm91bmRfY29sb3IiOiIjZmZmZmZmIiwidGhlbWVfY29sb3IiOiIjOEI0NTEzIn0=">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #f5e6d3 0%, #d4a574 100%);
            min-height: 100vh;
            padding-bottom: 80px;
            direction: rtl;
        }
        
        .header {
            background: linear-gradient(135deg, #8B4513 0%, #A0522D 100%);
            color: white;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header h1 {
            font-size: 1.5em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: space-between;
        }
        
        .active-timers {
            font-size: 0.7em;
            opacity: 0.9;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .timer-pulse {
            width: 8px;
            height: 8px;
            background: #4ade80;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .global-timers-section {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            padding: 12px;
            margin-top: 10px;
            display: none;
        }

        .global-timers-section.has-timers {
            display: block;
        }

        .global-timers-title {
            font-size: 0.9em;
            font-weight: 600;
            margin-bottom: 8px;
            opacity: 0.95;
        }

        .global-timer-item {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            padding: 8px 12px;
            margin-bottom: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85em;
        }

        .global-timer-item:last-child {
            margin-bottom: 0;
        }

        .global-timer-label {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .global-timer-time {
            font-weight: bold;
            font-variant-numeric: tabular-nums;
            font-size: 1.1em;
        }

        .sticky-bread-selector {
            position: sticky;
            top: 0;
            z-index: 99;
            margin: -20px -20px 20px -20px;
            padding: 15px 20px;
            background: linear-gradient(135deg, #f5e6d3 0%, #d4a574 100%);
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            border-radius: 0 0 12px 12px;
        }

        .sticky-bread-selector .bread-selector {
            margin-bottom: 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 15px;
        }

        .sticky-bread-selector .bread-selector h3 {
            font-size: 1em;
            margin-bottom: 10px;
        }

        .sticky-bread-selector .bread-item {
            padding: 10px;
            margin-bottom: 8px;
        }

        .sticky-bread-selector .bread-name {
            font-size: 0.95em;
        }

        .sticky-bread-selector .bread-progress {
            font-size: 0.8em;
        }

        .sticky-bread-selector .recipe-loader {
            display: none;
        }
        
        .progress-bar {
            background: rgba(255,255,255,0.3);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }
        
        .progress-fill {
            background: white;
            height: 100%;
            transition: width 0.3s ease;
            border-radius: 4px;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .step-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .step-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .step-number {
            background: linear-gradient(135deg, #8B4513 0%, #A0522D 100%);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2em;
        }
        
        .step-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #2c3e50;
            flex: 1;
            margin-left: 15px;
        }
        
        .step-content {
            color: #555;
            line-height: 1.6;
            margin: 15px 0;
        }
        
        .ingredients {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .ingredients h4 {
            color: #8B4513;
            margin-bottom: 10px;
        }
        
        .ingredient-item {
            padding: 5px 0;
            color: #555;
        }
        
        .timer-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .timer-display {
            font-size: 2.5em;
            font-weight: bold;
            text-align: center;
            margin: 10px 0;
            font-variant-numeric: tabular-nums;
            cursor: pointer;
            padding: 10px;
            border-radius: 8px;
            transition: background 0.3s ease;
        }

        .timer-display:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .timer-display input {
            background: transparent;
            border: none;
            color: white;
            font-size: 1em;
            font-weight: bold;
            text-align: center;
            width: 100%;
            font-variant-numeric: tabular-nums;
            outline: none;
        }

        .timer-adjust {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 10px 0;
        }

        .btn-adjust {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 60px;
        }

        .btn-adjust:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .btn-adjust:active {
            transform: scale(0.95);
        }
        
        .timer-label {
            text-align: center;
            opacity: 0.9;
            margin-bottom: 15px;
        }
        
        .timer-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn:active {
            transform: scale(0.95);
        }
        
        .btn-primary {
            background: white;
            color: #667eea;
        }
        
        .btn-primary:hover {
            background: #f0f0f0;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
        }
        
        .btn-next {
            background: linear-gradient(135deg, #8B4513 0%, #A0522D 100%);
            color: white;
            width: 100%;
            margin-top: 20px;
            justify-content: center;
            font-size: 1.1em;
        }
        
        .btn-back {
            background: #95a5a6;
            color: white;
            margin-top: 10px;
        }
        
        .navigation {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .completion {
            text-align: center;
            padding: 40px 20px;
        }
        
        .completion h2 {
            color: #8B4513;
            font-size: 2em;
            margin: 20px 0;
        }
        
        .completion-icon {
            font-size: 4em;
        }
        
        .tips {
            background: #fff9e6;
            border-left: 4px solid #f39c12;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
        }
        
        .tips strong {
            color: #f39c12;
        }
        
        .hidden {
            display: none;
        }

        .temperature {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 10px 15px;
            border-radius: 4px;
            margin: 10px 0;
            font-weight: 500;
            color: #2e7d32;
        }

        .bread-selector {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .bread-selector h3 {
            color: #8B4513;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .bread-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .bread-item:hover {
            background: #e9ecef;
            transform: translateX(-5px);
        }

        .bread-item.active {
            background: linear-gradient(135deg, #fff9e6 0%, #ffe6cc 100%);
            border-color: #8B4513;
        }

        .bread-name {
            font-weight: 600;
            color: #2c3e50;
            font-size: 1.1em;
            margin-bottom: 5px;
        }

        .bread-progress {
            color: #777;
            font-size: 0.9em;
        }

        .bread-timer-info {
            font-size: 0.85em;
            color: #667eea;
            font-weight: 600;
            margin-top: 4px;
            font-variant-numeric: tabular-nums;
        }

        .bread-header {
            background: white;
            border-radius: 12px;
            padding: 15px 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.1em;
        }

        .btn-small {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            background: #95a5a6;
            color: white;
            transition: all 0.3s ease;
        }

        .btn-small:hover {
            background: #7f8c8d;
        }

        .btn-small:active {
            transform: scale(0.95);
        }

        .btn-delete {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 0.85em;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
        }

        .btn-delete:hover {
            background: #c0392b;
        }

        .btn-delete:active {
            transform: scale(0.95);
        }

        .bread-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .bread-item-info {
            flex: 1;
        }

        .recipe-loader {
            background: #fff3cd;
            border: 2px dashed #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .recipe-loader h4 {
            color: #856404;
            margin-bottom: 10px;
            font-size: 1em;
        }

        .recipe-loader input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ffc107;
            border-radius: 6px;
            margin-bottom: 10px;
            font-size: 0.9em;
            direction: ltr;
            text-align: left;
        }

        .recipe-loader button {
            background: #ffc107;
            color: #856404;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .recipe-loader button:hover {
            background: #e0a800;
        }

        .recipe-info {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
            padding: 10px 15px;
            border-radius: 4px;
            margin-bottom: 15px;
            font-size: 0.9em;
            color: #0c5460;
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            
            .step-card {
                padding: 20px;
            }
            
            .timer-display {
                font-size: 2em;
            }
            
            .btn {
                padding: 10px 16px;
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>
            <span>ğŸ ××“×¨×™×š ×œ×—× ××—××¦×ª</span>
            <span class="active-timers" id="activeTimersIndicator"></span>
        </h1>
        <div class="progress-bar">
            <div class="progress-fill" id="progressBar"></div>
        </div>
        <div class="global-timers-section" id="globalTimersSection">
            <div class="global-timers-title">â±ï¸ ×˜×™×™××¨×™× ×¤×¢×™×œ×™×:</div>
            <div id="globalTimersList"></div>
        </div>
    </div>

    <div class="container">
        <div id="stepContainer"></div>
    </div>

    <script>
        const defaultRecipe = [
            {
                title: "×”×›× ×ª ×”×©××•×¨",
                content: "×•×“××• ×©×©××•×¨ ×”××—××¦×ª ×©×œ×›× ×¤×¢×™×œ ×•××‘×¢×‘×¢. ×”×•× ×¦×¨×™×š ×œ×”×›×¤×™×œ ××ª ×¢×¦××• ×‘×’×•×“×œ ×•×œ×¢×‘×•×¨ ××ª ××‘×—×Ÿ ×”×¦×™×¤×” (×›×¤×™×ª ×©××•×¨ ×¦×¤×” ×‘××™×).",
                ingredients: [
                    "100 ×’×¨× ×©××•×¨ ×¤×¢×™×œ",
                    "500 ×’×¨× ×§××— ×œ×—× (××• ×§××— ×¨×’×™×œ)",
                    "350 ×’×¨× ××™× (×‘×˜××¤×¨×˜×•×¨×ª ×”×—×“×¨)",
                    "10 ×’×¨× ××œ×—"
                ],
                timer: null,
                tips: "×× ×”×©××•×¨ ×œ× ×”×•×–×Ÿ ×œ××—×¨×•× ×”, ×”××›×™×œ×• ××•×ª×• 4-8 ×©×¢×•×ª ×œ×¤× ×™ ×”×”×ª×—×œ×”. ×”×•× ×¦×¨×™×š ×œ×”×¨×™×— ×—××¦××¥ ×•××ª×•×§ ××¢×˜."
            },
            {
                title: "××•×˜×•×œ×™×–×” (×¢×¨×‘×•×‘ ×§××— ×•××™×)",
                content: "×¢×¨×‘×‘×• ××ª ×”×§××— ×•-325 ×’×¨× ××™× (×©××¨×• 25 ×’×¨× ×œ×××•×—×¨ ×™×•×ª×¨) ×‘×§×¢×¨×” ×’×“×•×œ×”. ×¢×¨×‘×‘×• ×¢×“ ×©×œ× × ×©××¨ ×§××— ×™×‘×©. ×–×” ×××¤×©×¨ ×œ×§××— ×œ×”×¡×¤×’ ×•××¤×ª×— ×’×œ×•×˜×Ÿ ×‘××•×¤×Ÿ ×˜×‘×¢×™.",
                timer: { duration: 30, label: "×× ×•×—×ª ××•×˜×•×œ×™×–×”" },
                tips: "××œ ×ª×•×¡×™×¤×• ××œ×— ××• ×©××•×¨ ×¢×“×™×™×Ÿ! ×ª×§×•×¤×ª ×”×× ×•×—×” ×”×–×• ×”×•×¤×›×ª ××ª ×”×‘×¦×§ ×œ×§×œ ×™×•×ª×¨ ×œ×¢×‘×•×“×”."
            },
            {
                title: "×”×•×¡×¤×ª ×©××•×¨ ×•××œ×—",
                content: "×”×•×¡×™×¤×• ××ª ×”×©××•×¨ ×”×¤×¢×™×œ ×•×”××œ×— ×œ×‘×¦×§. ×”×©×ª××©×• ×‘-25 ×’×¨× ×”××™× ×”× ×•×ª×¨×™× ×›×“×™ ×œ×¡×™×™×¢ ×‘×”××¡×ª ×”××œ×—. ×œ×—×¦×• ×”×›×œ ×‘×™×—×“ ×¢× ×”×™×“×™×™× ×¢×“ ×©×”×›×œ ××©×•×œ×‘ ×œ×—×œ×•×˜×™×Ÿ - ×–×” ×™×”×™×” ×“×‘×™×§ ×•××‘×•×œ×’×Ÿ!",
                timer: null,
                tips: "×”×¨×˜×™×‘×• ××ª ×”×™×“×™×™× ×›×“×™ ×œ×× ×•×¢ ×”×™×“×‘×§×•×ª. ×”×‘×¦×§ ×™×”×™×” ×¤×¨×•×¢ ×‘×”×ª×—×œ×” - ×–×” × ×•×¨××œ×™."
            },
            {
                title: "××ª×™×—×” ×•×§×™×¤×•×œ #1",
                content: "×¢×›×©×™×• ××ª×—×™×œ×” ×”×ª×¡×™×¡×” ×”×¨××©×•× ×™×ª! ×‘×¦×¢×• ××ª ×¡×˜ ×”××ª×™×—×” ×•×”×§×™×¤×•×œ ×”×¨××©×•×Ÿ: ×”×¨×˜×™×‘×• ××ª ×”×™×“×™×™×, ××—×–×• ×‘×¦×“ ××—×“ ×©×œ ×”×‘×¦×§, ××ª×—×• ××•×ª×• ×œ××¢×œ×”, ×•×§×¤×œ×• ××•×ª×•. ×¡×•×‘×‘×• ××ª ×”×§×¢×¨×” 90 ××¢×œ×•×ª ×•×—×–×¨×• 4 ×¤×¢××™× (×¦×¤×•×Ÿ, ×“×¨×•×, ××–×¨×—, ××¢×¨×‘).",
                timer: { duration: 30, label: "×¢×“ ××ª×™×—×” ×•×§×™×¤×•×œ #2" },
                temperature: "×©××¨×• ×‘×˜××¤×¨×˜×•×¨×” ×©×œ 24-26Â°C. ×—× ×™×•×ª×¨ = ×ª×¡×™×¡×” ××”×™×¨×” ×™×•×ª×¨.",
                tips: "×”×‘×¦×§ ×™×”×™×” ×¨×š ×•×“×‘×™×§. ××œ ×ª×•×¡×™×¤×• ×™×•×ª×¨ ××“×™ ×§××— - ×¨×§ ×”×¨×˜×™×‘×• ××ª ×”×™×“×™×™×."
            },
            {
                title: "××ª×™×—×” ×•×§×™×¤×•×œ #2",
                content: "×‘×¦×¢×• ××ª ×¡×˜ ×”××ª×™×—×” ×•×”×§×™×¤×•×œ ×”×©× ×™: ×”×¨×˜×™×‘×• ××ª ×”×™×“×™×™×, ××ª×—×• ×•×§×¤×œ×• ××›×œ 4 ×”×¦×“×“×™×. ×”×‘×¦×§ ×›×‘×¨ ×××•×¨ ×œ×”×¨×’×™×© ×§×¦×ª ×™×•×ª×¨ ×—×–×§ ×•×¤×—×•×ª ×“×‘×™×§.",
                timer: { duration: 30, label: "×¢×“ ××ª×™×—×” ×•×§×™×¤×•×œ #3" },
                temperature: "×©××¨×• ×‘×˜××¤×¨×˜×•×¨×” ×©×œ 24-26Â°C.",
                tips: "×©×™××• ×œ×‘ ××™×š ×”×‘×¦×§ ××ª×—×™×œ ×œ×¤×ª×— ××‘× ×” ×•×›×•×—."
            },
            {
                title: "××ª×™×—×” ×•×§×™×¤×•×œ #3",
                content: "×‘×¦×¢×• ××ª ×¡×˜ ×”××ª×™×—×” ×•×”×§×™×¤×•×œ ×”×©×œ×™×©×™: ×”×¨×˜×™×‘×• ××ª ×”×™×“×™×™×, ××ª×—×• ×•×§×¤×œ×• ××›×œ 4 ×”×¦×“×“×™×. ×”×‘×¦×§ ×××•×¨ ×œ×”×¨×’×™×© ×”×¨×‘×” ×™×•×ª×¨ ×—×œ×§ ×•××œ×¡×˜×™.",
                timer: { duration: 30, label: "×¢×“ ××ª×™×—×” ×•×§×™×¤×•×œ #4" },
                temperature: "×©××¨×• ×‘×˜××¤×¨×˜×•×¨×” ×©×œ 24-26Â°C.",
                tips: "×”×‘×¦×§ ×××•×¨ ×œ×”×ª×—×™×œ ×œ×”×¨××•×ª ××•×•×¨×™×¨×™ ×¢× ×‘×•×¢×•×ª ×§×˜× ×•×ª."
            },
            {
                title: "××ª×™×—×” ×•×§×™×¤×•×œ #4 (××—×¨×•×Ÿ)",
                content: "×‘×¦×¢×• ××ª ×¡×˜ ×”××ª×™×—×” ×•×”×§×™×¤×•×œ ×”××—×¨×•×Ÿ: ×”×¨×˜×™×‘×• ××ª ×”×™×“×™×™×, ××ª×—×• ×•×§×¤×œ×• ××›×œ 4 ×”×¦×“×“×™×. ×–×” ×”×¡×˜ ×”××—×¨×•×Ÿ ×œ×¤× ×™ ×”×× ×•×—×” ×”××¨×•×›×”.",
                timer: { duration: 30, label: "×”×ª×—×œ×ª ×× ×•×—×”" },
                temperature: "×©××¨×• ×‘×˜××¤×¨×˜×•×¨×” ×©×œ 24-26Â°C.",
                tips: "××—×¨×™ ×”×˜×™×™××¨ ×”×–×”, ×¢×‘×¨×• ×œ×©×œ×‘ ×”×‘× - ×× ×•×—×ª ×”×ª×¡×™×¡×”."
            },
            {
                title: "×× ×•×—×ª ×ª×¡×™×¡×” ×¨××©×•× ×™×ª",
                content: "×¢×›×©×™×• ×ª× ×• ×œ×‘×¦×§ ×œ× ×•×— ×œ×œ× ×”×¤×¨×¢×” ×œ××©×š 2-2.5 ×©×¢×•×ª. ×›×¡×• ××ª ×”×§×¢×¨×” ×”×™×˜×‘. ×”×‘×¦×§ ×¦×¨×™×š ×œ×’×“×•×œ ×‘-30-50% ×‘× ×¤×— ×•×œ×”×¨×’×™×© ××•×•×¨×™×¨×™ ×•××œ× ×‘×•×¢×•×ª.",
                timer: { duration: 120, label: "×× ×•×—×ª ×ª×¡×™×¡×”" },
                temperature: "×©××¨×• ×‘×˜××¤×¨×˜×•×¨×” ×©×œ 24-26Â°C.",
                tips: "××œ ×ª×¤×¨×™×¢×• ×œ×‘×¦×§! ×–×” ×”×–××Ÿ ×©×‘×• ×”×•× ××¤×ª×— ×˜×¢× ×•××‘× ×”. ×”×•× ×¦×¨×™×š ×œ×”×™×¨××•×ª × ×¤×•×— ×•××œ× ×—×™×™×."
            },
            {
                title: "×¢×™×¦×•×‘ ×•×¢×™×¦×•×‘ ××§×“×™×",
                content: "×”×¤×›×• ××ª ×”×‘×¦×§ ×¢×œ ××©×˜×— ××§×•××— ×§×œ×•×ª. ×¢×¦×‘×• ×‘×¢×“×™× ×•×ª ×œ×›×“×•×¨ ×¢×œ ×™×“×™ ××©×™×›×ª ×”×§×¦×•×•×ª ×œ××¨×›×–. ×ª× ×• ×œ×• ×œ× ×•×— 20-30 ×“×§×•×ª (×× ×•×—×ª ×¡×¤×¡×œ), ×•××– ×‘×¦×¢×• ××ª ×”×¢×™×¦×•×‘ ×”×¡×•×¤×™: ×”×¤×›×• ××•×ª×•, ×¦×¨×• ××ª×— ×¢×œ ×™×“×™ ××©×™×›×ª ×”×‘×¦×§ ×œ×¢×‘×¨×›× ×ª×•×š ×›×“×™ ×¡×™×‘×•×‘.",
                timer: { duration: 25, label: "×× ×•×—×ª ×¡×¤×¡×œ" },
                tips: "××œ ×ª×•×¡×™×¤×• ×™×•×ª×¨ ××“×™ ×§××—! ××ª× ×¨×•×¦×™× ×©×”×‘×¦×§ ×™×™×“×‘×§ ××¢×˜ ×œ×©×•×œ×—×Ÿ ×›×“×™ ×œ×™×¦×•×¨ ××ª×—."
            },
            {
                title: "×ª×¤×™×—×” ×§×¨×” ×‘××§×¨×¨",
                content: "×”× ×™×—×• ××ª ×”×‘×¦×§ ×”××¢×•×¦×‘ ×¢× ×”×¦×“ ×”×ª×¤×•×¨ ×›×œ×¤×™ ××¢×œ×” ×‘×¡×œ ×ª×¡×™×¡×” ××§×•××— ××• ×‘×§×¢×¨×” ××¨×•×¤×“×ª ×‘××’×‘×ª. ×›×¡×• ×”×™×˜×‘ ×•×”×›× ×™×¡×• ×œ××§×¨×¨ ×œ-8-24 ×©×¢×•×ª. ×–×” ××¤×ª×— ×˜×¢× ×•×”×•×¤×š ××ª ×”×—×¨×™×¦×” ×œ×§×œ×” ×™×•×ª×¨.",
                timer: { duration: 480, label: "×ª×¤×™×—×” ×§×¨×” (××™× ×™××•× 8 ×©×¢×•×ª)" },
                tips: "××¨×•×š ×™×•×ª×¨ = ×˜×¢× ×—××•×¥ ×™×•×ª×¨! ××¤×©×¨ ×œ×”×’×™×¢ ×¢×“ 36 ×©×¢×•×ª ×‘××™×“×ª ×”×¦×•×¨×š."
            },
            {
                title: "×—×™××•× ×”×ª× ×•×¨",
                content: "×—×××• ××ª ×”×ª× ×•×¨ ×œ-260Â°C ×¢× ×¡×™×¨ ×”×•×œ× ×“×™ ×‘×¤× ×™×. ×ª×•×š ×›×“×™, ×”×•×¦×™××• ××ª ×”×‘×¦×§ ××”××§×¨×¨ ×•×”× ×™×—×• ×¢×œ × ×™×™×¨ ××¤×™×™×”. ×—×¨×¦×• ×‘×–×”×™×¨×•×ª ×¢× ×œ×”×‘ ×—×“.",
                timer: { duration: 50, label: "×—×™××•× ×”×ª× ×•×¨" },
                temperature: "×ª× ×•×¨: 260Â°C",
                tips: "×—×©×•×‘ ×œ×—×× ××ª ×”×¡×™×¨ ×”×”×•×œ× ×“×™ ×™×—×“ ×¢× ×”×ª× ×•×¨ ×›×“×™ ×©×™×”×™×” ×—× ×××•×“."
            },
            {
                title: "××¤×™×™×” ×¢× ××›×¡×”",
                content: "×”× ×™×—×• ××ª ×”×‘×¦×§ ×‘×¡×™×¨ ×”×”×•×œ× ×“×™ ×”×—× ×‘×–×”×™×¨×•×ª (×”×©×ª××©×• ×‘× ×™×™×¨ ×”××¤×™×™×” ×›×“×™ ×œ×”×¨×™× ××•×ª×•). ×¡×’×¨×• ××ª ×”××›×¡×” ×•××¤×• ×‘-260Â°C.",
                timer: { duration: 20, label: "××¤×™×™×” ×¢× ××›×¡×”" },
                temperature: "×ª× ×•×¨: 260Â°C",
                tips: "×”××›×¡×” ×™×•×¦×¨ ××“×™× ×©×¢×•×–×¨×™× ×œ×œ×—× ×œ×”×ª×¤×ª×— ×•×œ×§×‘×œ ×§×¨×•× ×™×¤×”."
            },
            {
                title: "××¤×™×™×” ×œ×œ× ××›×¡×”",
                content: "×”×¡×™×¨×• ××ª ×”××›×¡×” ×‘×–×”×™×¨×•×ª (×™×”×™×” ×”×¨×‘×” ××“×™×!). ×”×•×¨×™×“×• ××ª ×”×˜××¤×¨×˜×•×¨×” ×œ-230Â°C ×•×”××©×™×›×• ×œ××¤×•×ª ×¢×“ ×©×”×œ×—× ××§×‘×œ ×¦×‘×¢ ×—×•× ×–×”×•×‘.",
                timer: { duration: 28, label: "××¤×™×™×” ×œ×œ× ××›×¡×”" },
                temperature: "×ª× ×•×¨: 230Â°C",
                tips: "×”×œ×—× ×¦×¨×™×š ×œ×”×™×•×ª ×—×•× ×–×”×•×‘ ×™×¤×”. ××œ ×ª×¤×—×“×• ××¦×‘×¢ ×›×”×” - ×–×” ××•×¡×™×£ ×˜×¢×!"
            },
            {
                title: "×§×™×¨×•×¨ ××œ×",
                content: "×”×•×¦×™××• ××ª ×”×œ×—× ×•×”× ×™×—×• ××•×ª×• ×¢×œ ×¨×©×ª ×§×™×¨×•×¨. ×–×” ×”×—×œ×§ ×”×§×©×” ×‘×™×•×ª×¨ - ××ª× ×—×™×™×‘×™× ×œ×—×›×•×ª ×œ×¤×—×•×ª 1-2 ×©×¢×•×ª ×œ×¤× ×™ ×”×—×™×ª×•×š! ×”×œ×—× ×¢×“×™×™×Ÿ ××ª×‘×©×œ ×‘×¤× ×™× ×•×”×¤×™×¨×•×¨×™×ª ××ª×§×‘×¢×ª.",
                timer: { duration: 90, label: "×–××Ÿ ×§×™×¨×•×¨" },
                tips: "×”×§×©×™×‘×• ×œ×•! ×œ×—× ×˜×¨×™ ××•×¦×™× ×¦×œ×™×œ×™ ×¤×¦×¤×•×¥ ×›×©×”×•× ××ª×§×¨×¨. ×× ×ª×—×ª×›×• ××•×§×“× ××“×™, ×”×¤× ×™× ×™×”×™×” ×“×‘×™×§."
            }
        ];

        let recipeSteps = defaultRecipe;

        // Multi-bread support
        let breads = {};
        let currentBreadId = null;
        let timerUpdateInterval = null;

        function getCurrentBread() {
            if (!currentBreadId || !breads[currentBreadId]) {
                return null;
            }
            return breads[currentBreadId];
        }

        function updateActiveTimersIndicator() {
            const indicator = document.getElementById('activeTimersIndicator');
            const globalTimersSection = document.getElementById('globalTimersSection');
            const globalTimersList = document.getElementById('globalTimersList');

            if (!indicator || !globalTimersSection || !globalTimersList) return;

            let activeCount = 0;
            const timerData = [];

            Object.values(breads).forEach(bread => {
                Object.entries(bread.timers).forEach(([timerId, timer]) => {
                    if (timer.running) {
                        activeCount++;
                        const stepMatch = timerId.match(/timer-(\d+)/);
                        const stepIndex = stepMatch ? parseInt(stepMatch[1]) : 0;
                        const stepLabel = recipeSteps[stepIndex]?.timer?.label || '×˜×™×™××¨';

                        timerData.push({
                            breadName: bread.name,
                            stepLabel: stepLabel,
                            timerId: timerId,
                            breadId: bread.id
                        });
                    }
                });
            });

            if (activeCount > 0) {
                indicator.innerHTML = `<span class="timer-pulse"></span> ${activeCount} ×˜×™×™××¨${activeCount > 1 ? '×™×' : ''} ×¤×¢×™×œ${activeCount > 1 ? '×™×' : ''}`;
                indicator.style.display = 'flex';

                // Build HTML with data attributes for real-time updates
                let timersHTML = '';
                timerData.forEach(data => {
                    const timer = breads[data.breadId].timers[data.timerId];
                    const remaining = getTimerRemaining(timer);
                    timersHTML += `
                        <div class="global-timer-item" data-bread-id="${data.breadId}" data-timer-id="${data.timerId}">
                            <div class="global-timer-label">
                                <span class="timer-pulse"></span>
                                <span>${data.breadName} - ${data.stepLabel}</span>
                            </div>
                            <div class="global-timer-time">${formatTime(remaining)}</div>
                        </div>
                    `;
                });

                globalTimersList.innerHTML = timersHTML;
                globalTimersSection.classList.add('has-timers');
            } else {
                indicator.style.display = 'none';
                globalTimersSection.classList.remove('has-timers');
            }
        }

        function updateGlobalTimersDisplay() {
            // Update the time displays in real-time without rebuilding the entire HTML
            const globalTimerItems = document.querySelectorAll('.global-timer-item');

            globalTimerItems.forEach(item => {
                const breadId = item.getAttribute('data-bread-id');
                const timerId = item.getAttribute('data-timer-id');

                if (breadId && timerId && breads[breadId] && breads[breadId].timers[timerId]) {
                    const timer = breads[breadId].timers[timerId];
                    if (timer.running) {
                        const remaining = getTimerRemaining(timer);
                        const timeDisplay = item.querySelector('.global-timer-time');
                        if (timeDisplay) {
                            timeDisplay.textContent = formatTime(remaining);
                        }
                    }
                }
            });
        }

        function getTimerRemaining(timer) {
            if (!timer.running) {
                return timer.remaining;
            }
            const now = Date.now();
            const elapsed = Math.floor((now - timer.startTime) / 1000);
            return Math.max(0, timer.remaining - elapsed);
        }

        function renderCompactBreadSelector() {
            const breadList = Object.keys(breads).map(id => {
                const bread = breads[id];
                const isActive = id === currentBreadId;
                const progress = Math.round((bread.currentStep + 1) / recipeSteps.length * 100);

                // Get active timers for this bread
                let timerInfo = '';
                const activeTimers = [];
                Object.entries(bread.timers).forEach(([timerId, timer]) => {
                    if (timer.running) {
                        const remaining = getTimerRemaining(timer);
                        activeTimers.push(formatTime(remaining));
                    }
                });

                if (activeTimers.length > 0) {
                    timerInfo = `<div class="bread-timer-info">â±ï¸ ${activeTimers.join(', ')}</div>`;
                }

                return `
                    <div class="bread-item ${isActive ? 'active' : ''}" data-bread-id="${id}">
                        <div class="bread-item-header">
                            <div class="bread-item-info" onclick="switchBread('${id}')">
                                <div class="bread-name">${bread.name}</div>
                                <div class="bread-progress">${progress}% - ×©×œ×‘ ${bread.currentStep + 1}/${recipeSteps.length}</div>
                                ${timerInfo}
                            </div>
                            <button class="btn-delete" onclick="event.stopPropagation(); confirmDeleteBread('${id}')">ğŸ—‘ï¸ ××—×§</button>
                        </div>
                    </div>
                `;
            }).join('');

            return `
                <div class="bread-selector">
                    <h3>×”×œ×—××™× ×©×œ×™:</h3>
                    ${breadList}
                    <button class="btn btn-success" onclick="createNewBread()" style="margin-top: 10px; width: 100%;">
                        â• ×”×ª×—×œ ×œ×—× ×—×“×©
                    </button>
                </div>
            `;
        }

        function renderBreadSelector() {
            const breadList = Object.keys(breads).map(id => {
                const bread = breads[id];
                const isActive = id === currentBreadId;
                const progress = Math.round((bread.currentStep + 1) / recipeSteps.length * 100);
                return `
                    <div class="bread-item ${isActive ? 'active' : ''}">
                        <div class="bread-item-header">
                            <div class="bread-item-info" onclick="switchBread('${id}')">
                                <div class="bread-name">${bread.name}</div>
                                <div class="bread-progress">${progress}% - ×©×œ×‘ ${bread.currentStep + 1}/${recipeSteps.length}</div>
                            </div>
                            <button class="btn-delete" onclick="event.stopPropagation(); confirmDeleteBread('${id}')">ğŸ—‘ï¸ ××—×§</button>
                        </div>
                    </div>
                `;
            }).join('');

            const isCustomRecipe = recipeSteps !== defaultRecipe;
            const recipeInfo = isCustomRecipe ? `
                <div class="recipe-info">
                    ğŸ“– ××©×ª××© ×‘××ª×›×•×Ÿ ××•×ª×× ××™×©×™×ª (${recipeSteps.length} ×©×œ×‘×™×)
                </div>
            ` : '';

            return `
                <div class="bread-selector">
                    ${recipeInfo}
                    <h3>×”×œ×—××™× ×©×œ×™:</h3>
                    ${breadList}
                    <button class="btn btn-success" onclick="createNewBread()" style="margin-top: 10px; width: 100%;">
                        â• ×”×ª×—×œ ×œ×—× ×—×“×©
                    </button>

                    <div class="recipe-loader" style="margin-top: 20px;">
                        <h4>ğŸ“– ×˜×¢×Ÿ ××ª×›×•×Ÿ ××•×ª×× ××™×©×™×ª</h4>
                        <input type="text" id="recipeUrlInput" placeholder="https://example.com/my-recipe.json" />
                        <button onclick="loadCustomRecipe()">×˜×¢×Ÿ ××ª×›×•×Ÿ</button>
                        <div style="margin-top: 10px; font-size: 0.85em; color: #856404;">
                            ××• ×”×•×¡×£ ?recipe=URL ×œ×›×ª×•×‘×ª ×”×“×£
                        </div>
                    </div>
                </div>
            `;
        }

        function renderStep() {
            const bread = getCurrentBread();
            if (!bread) {
                document.getElementById('stepContainer').innerHTML = renderBreadSelector();
                return;
            }

            const currentStep = bread.currentStep;
            const step = recipeSteps[currentStep];
            const container = document.getElementById('stepContainer');
            const progressBar = document.getElementById('progressBar');

            progressBar.style.width = ((currentStep + 1) / recipeSteps.length * 100) + '%';

            updateActiveTimersIndicator();

            // Render sticky bread selector first
            const stickySelector = `
                <div class="sticky-bread-selector">
                    ${renderCompactBreadSelector()}
                </div>
            `;

            if (currentStep >= recipeSteps.length) {
                container.innerHTML = stickySelector + `
                    <div class="step-card completion">
                        <div class="completion-icon">ğŸ‰</div>
                        <h2>×›×œ ×”×›×‘×•×“!</h2>
                        <p style="font-size: 1.2em; color: #555; margin: 20px 0;">××¤×™×ª× ×›×™×›×¨ ×œ×—× ××—××¦×ª ××“×”×™××”!</p>
                        <p style="color: #777;">×ª×”× ×• ××”×œ×—× ×”×‘×™×ª×™ ×©×œ×›×. ×›×›×œ ×©×ª×ª×¨×’×œ×• ×™×•×ª×¨, ×›×š ×–×” ×™×”×™×” ×˜×•×‘ ×™×•×ª×¨!</p>
                        <button class="btn btn-success" onclick="confirmDeleteBread('${currentBreadId}')" style="margin-top: 30px;">
                            âœ… ×¡×™×™××ª×™ - ××—×§ ×œ×—× ×–×”
                        </button>
                        <button class="btn btn-back" onclick="viewAllBreads()" style="width: 100%;">
                            â† ×—×–×•×¨ ×œ×¨×©×™××ª ×”×œ×—××™×
                        </button>
                    </div>
                `;
                return;
            }

            // Build list of all active timers for this bread
            let allActiveTimersHtml = '';
            const activeTimersList = [];
            Object.entries(bread.timers).forEach(([timerId, timer]) => {
                if (timer.running) {
                    const stepMatch = timerId.match(/timer-(\d+)/);
                    const stepIndex = stepMatch ? parseInt(stepMatch[1]) : 0;
                    const stepLabel = recipeSteps[stepIndex]?.timer?.label || recipeSteps[stepIndex]?.title || '×˜×™×™××¨';
                    const remaining = getTimerRemaining(timer);
                    activeTimersList.push({
                        timerId,
                        stepIndex,
                        stepLabel,
                        remaining
                    });
                }
            });

            if (activeTimersList.length > 0) {
                allActiveTimersHtml = `
                    <div class="all-active-timers">
                        <h4>â±ï¸ ×˜×™×™××¨×™× ×¤×¢×™×œ×™× ×œ×œ×—× ×–×”:</h4>
                        ${activeTimersList.map(t => `
                            <div class="active-timer-item">
                                <span>×©×œ×‘ ${t.stepIndex + 1}: ${t.stepLabel}</span>
                                <span class="active-timer-time" id="active-${bread.id}-${t.timerId}">${formatTime(t.remaining)}</span>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            let html = stickySelector + `
                <div class="bread-header">
                    <strong>ğŸ ${bread.name}</strong>
                    <div>
                        <button class="btn-delete" onclick="confirmDeleteBread('${currentBreadId}')" style="margin-left: 10px;">ğŸ—‘ï¸ ××—×§ ×œ×—×</button>
                        <button class="btn-small" onclick="viewAllBreads()">â† ×›×œ ×”×œ×—××™×</button>
                    </div>
                </div>
                ${allActiveTimersHtml}
                <div class="step-card">
                    <div class="step-header">
                        <div class="step-number">${currentStep + 1}</div>
                        <div class="step-title">${step.title}</div>
                    </div>

                    <div class="step-content">
                        ${step.content}
                    </div>
            `;

            if (step.ingredients) {
                html += `
                    <div class="ingredients">
                        <h4>ğŸ“ ××¦×¨×›×™×:</h4>
                        ${step.ingredients.map(ing => `<div class="ingredient-item">â€¢ ${ing}</div>`).join('')}
                    </div>
                `;
            }

            if (step.temperature) {
                html += `<div class="temperature">ğŸŒ¡ï¸ ${step.temperature}</div>`;
            }

            if (step.tips) {
                html += `
                    <div class="tips">
                        <strong>ğŸ’¡ Tip:</strong> ${step.tips}
                    </div>
                `;
            }

            if (step.timer) {
                const timerId = `timer-${currentStep}`;
                const timerState = bread.timers[timerId] || { remaining: step.timer.duration * 60, running: false, startTime: null };
                const displayTime = getTimerRemaining(timerState);
                const domTimerId = `${bread.id}-${timerId}`; // Unique DOM ID per bread

                html += `
                    <div class="timer-section">
                        <div class="timer-label">${step.timer.label}</div>
                        <div class="timer-display" id="${domTimerId}-display" onclick="editTimer('${timerId}')" title="×œ×—×¥ ×œ×¢×¨×™×›×”">
                            ${formatTime(displayTime)}
                        </div>
                        <div class="timer-adjust">
                            <button class="btn-adjust" onclick="adjustTimer('${timerId}', -300)">-5 ×“×§×³</button>
                            <button class="btn-adjust" onclick="adjustTimer('${timerId}', -60)">-1 ×“×§×³</button>
                            <button class="btn-adjust" onclick="adjustTimer('${timerId}', 60)">+1 ×“×§×³</button>
                            <button class="btn-adjust" onclick="adjustTimer('${timerId}', 300)">+5 ×“×§×³</button>
                        </div>
                        <div class="timer-buttons">
                            <button class="btn btn-primary" onclick="toggleTimer('${timerId}', ${step.timer.duration * 60})">
                                <span id="${domTimerId}-btn-text">${timerState.running ? 'â¸ï¸ ×”×©×”×”' : 'â–¶ï¸ ×”×ª×—×œ'}</span>
                            </button>
                            <button class="btn btn-primary" onclick="resetTimer('${timerId}', ${step.timer.duration * 60})">
                                ğŸ”„ ××¤×¡
                            </button>
                        </div>
                    </div>
                `;
            }

            html += `
                    <div class="navigation">
                        ${currentStep > 0 ? '<button class="btn btn-back" onclick="previousStep()">â†’ ×”×§×•×“×</button>' : ''}
                        <button class="btn btn-next" onclick="nextStep()">
                            ${currentStep < recipeSteps.length - 1 ? '×”×‘× â†' : '×¡×™×•×! ğŸ‰'}
                        </button>
                    </div>
                </div>
            `;

            container.innerHTML = html;
        }

        function formatTime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;

            if (hours > 0) {
                return `${hours}:${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
            }
            return `${minutes}:${String(secs).padStart(2, '0')}`;
        }

        function toggleTimer(timerId, initialDuration) {
            const bread = getCurrentBread();
            if (!bread) return;

            if (!bread.timers[timerId]) {
                bread.timers[timerId] = { remaining: initialDuration, running: false, startTime: null };
            }

            const timer = bread.timers[timerId];

            if (timer.running) {
                // Pause: calculate actual remaining time
                const elapsed = Math.floor((Date.now() - timer.startTime) / 1000);
                timer.remaining = Math.max(0, timer.remaining - elapsed);
                timer.running = false;
                timer.startTime = null;
            } else {
                // Check if another timer is already running for this bread
                const hasRunningTimer = Object.entries(bread.timers).some(([id, t]) => {
                    return id !== timerId && t.running;
                });

                if (hasRunningTimer) {
                    alert('×›×‘×¨ ×™×© ×˜×™×™××¨ ×¤×¢×™×œ ×œ×œ×—× ×–×”. ×¢×¦×•×¨ ××• ×”××ª×Ÿ ×œ×¡×™×•× ×”×˜×™×™××¨ ×”×§×™×™× ×œ×¤× ×™ ×”×¤×¢×œ×ª ×˜×™×™××¨ ×—×“×©.');
                    return;
                }

                // Start: record start time
                timer.running = true;
                timer.startTime = Date.now();
            }

            const domTimerId = `${bread.id}-${timerId}`;
            const btnText = document.getElementById(`${domTimerId}-btn-text`);
            if (btnText) {
                btnText.textContent = timer.running ? 'â¸ï¸ ×”×©×”×”' : 'â–¶ï¸ ×”×ª×—×œ';
            }

            updateActiveTimersIndicator();
            saveProgress();
        }

        function resetTimer(timerId, initialDuration) {
            const bread = getCurrentBread();
            if (!bread) return;

            bread.timers[timerId] = { remaining: initialDuration, running: false, startTime: null };
            const domTimerId = `${bread.id}-${timerId}`;
            const display = document.getElementById(`${domTimerId}-display`);
            if (display) {
                display.textContent = formatTime(initialDuration);
            }
            const btnText = document.getElementById(`${domTimerId}-btn-text`);
            if (btnText) {
                btnText.textContent = 'â–¶ï¸ ×”×ª×—×œ';
            }
            updateActiveTimersIndicator();
            saveProgress();
        }

        function ensureTimerExists(timerId, initialDuration) {
            const bread = getCurrentBread();
            if (!bread) return null;

            if (!bread.timers[timerId]) {
                bread.timers[timerId] = {
                    remaining: initialDuration,
                    running: false,
                    startTime: null
                };
            }
            return bread.timers[timerId];
        }

        function adjustTimer(timerId, seconds) {
            const bread = getCurrentBread();
            if (!bread) return;

            // Get initial duration from the timer display's data attribute or calculate from current step
            const currentStep = bread.currentStep;
            const step = recipeSteps[currentStep];
            const initialDuration = step.timer ? step.timer.duration * 60 : 0;

            const timer = ensureTimerExists(timerId, initialDuration);
            if (!timer) return;

            if (timer.running) {
                // If running, adjust the remaining time by modifying startTime
                const currentRemaining = getTimerRemaining(timer);
                const newRemaining = Math.max(0, currentRemaining + seconds);
                timer.remaining = newRemaining;
                timer.startTime = Date.now();
            } else {
                // If paused, just adjust the remaining time
                timer.remaining = Math.max(0, timer.remaining + seconds);
            }

            const domTimerId = `${bread.id}-${timerId}`;
            const display = document.getElementById(`${domTimerId}-display`);
            if (display) {
                display.textContent = formatTime(timer.running ? getTimerRemaining(timer) : timer.remaining);
            }

            saveProgress();
        }

        function editTimer(timerId) {
            const bread = getCurrentBread();
            if (!bread) return;

            // Get initial duration from current step
            const currentStep = bread.currentStep;
            const step = recipeSteps[currentStep];
            const initialDuration = step.timer ? step.timer.duration * 60 : 0;

            const timer = ensureTimerExists(timerId, initialDuration);
            if (!timer) return;

            if (timer.running) {
                alert('×¢×¦×•×¨ ××ª ×”×˜×™×™××¨ ×œ×¤× ×™ ×¢×¨×™×›×”');
                return; // Don't allow editing while running
            }

            const domTimerId = `${bread.id}-${timerId}`;
            const display = document.getElementById(`${domTimerId}-display`);
            if (!display) return;

            const currentTime = timer.remaining;
            const hours = Math.floor(currentTime / 3600);
            const minutes = Math.floor((currentTime % 3600) / 60);
            const seconds = currentTime % 60;

            const timeString = hours > 0
                ? `${hours}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`
                : `${minutes}:${String(seconds).padStart(2, '0')}`;

            const input = prompt('×¢×¨×•×š ×–××Ÿ (×¤×•×¨××˜: MM:SS ××• HH:MM:SS):', timeString);

            if (input) {
                const parts = input.split(':').map(p => parseInt(p.trim()));
                let newSeconds = 0;

                if (parts.length === 2) {
                    // MM:SS
                    newSeconds = parts[0] * 60 + parts[1];
                } else if (parts.length === 3) {
                    // HH:MM:SS
                    newSeconds = parts[0] * 3600 + parts[1] * 60 + parts[2];
                }

                if (newSeconds > 0 && !isNaN(newSeconds)) {
                    timer.remaining = newSeconds;
                    display.textContent = formatTime(newSeconds);
                    saveProgress();
                } else {
                    alert('×¤×•×¨××˜ ×œ× ×ª×§×™×Ÿ. ×”×©×ª××© ×‘-MM:SS ××• HH:MM:SS');
                }
            }
        }

        function updateAllTimers() {
            // Update all running timers across all breads
            let needsUpdate = false;
            Object.values(breads).forEach(bread => {
                Object.keys(bread.timers).forEach(timerId => {
                    const timer = bread.timers[timerId];
                    if (timer.running) {
                        const remaining = getTimerRemaining(timer);
                        const domTimerId = `${bread.id}-${timerId}`;
                        const display = document.getElementById(`${domTimerId}-display`);
                        if (display) {
                            display.textContent = formatTime(remaining);
                        }

                        // Check if timer finished
                        if (remaining <= 0) {
                            timer.running = false;
                            timer.remaining = 0;
                            timer.startTime = null;

                            const btnText = document.getElementById(`${domTimerId}-btn-text`);
                            if (btnText) {
                                btnText.textContent = 'â–¶ï¸ ×”×ª×—×œ';
                            }

                            playNotification();
                            showNotification(`â° ×”×˜×™×™××¨ ×”×¡×ª×™×™×! (${bread.name})`);
                            updateActiveTimersIndicator();
                            saveProgress();
                            needsUpdate = true;
                        }
                    }
                });
            });

            // Always update all timer displays in real-time
            updateGlobalTimersDisplay();
            updateStickyBreadSelectorTimers();
        }

        function updateStickyBreadSelectorTimers() {
            // Update timer info in sticky bread selector in real-time
            Object.keys(breads).forEach(id => {
                const bread = breads[id];
                const breadItem = document.querySelector(`.sticky-bread-selector .bread-item[data-bread-id="${id}"]`);

                if (breadItem) {
                    let timerInfoElement = breadItem.querySelector('.bread-timer-info');

                    const activeTimers = [];
                    Object.entries(bread.timers).forEach(([timerId, timer]) => {
                        if (timer.running) {
                            const remaining = getTimerRemaining(timer);
                            activeTimers.push(formatTime(remaining));
                        }
                    });

                    if (activeTimers.length > 0) {
                        const timerText = `â±ï¸ ${activeTimers.join(', ')}`;
                        if (timerInfoElement) {
                            // Update existing element
                            timerInfoElement.textContent = timerText;
                            timerInfoElement.style.display = 'block';
                        } else {
                            // Create new element if it doesn't exist
                            const breadItemInfo = breadItem.querySelector('.bread-item-info');
                            if (breadItemInfo) {
                                timerInfoElement = document.createElement('div');
                                timerInfoElement.className = 'bread-timer-info';
                                timerInfoElement.textContent = timerText;
                                breadItemInfo.appendChild(timerInfoElement);
                            }
                        }
                    } else {
                        // Hide timer info if no active timers
                        if (timerInfoElement) {
                            timerInfoElement.style.display = 'none';
                        }
                    }
                }
            });
        }

        function startGlobalTimerUpdate() {
            if (timerUpdateInterval) {
                clearInterval(timerUpdateInterval);
            }
            timerUpdateInterval = setInterval(updateAllTimers, 1000);
        }

        function playNotification() {
            // Create multiple beep sounds for better attention
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();

            // Beep 3 times
            for (let i = 0; i < 3; i++) {
                setTimeout(() => {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();

                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);

                    oscillator.frequency.value = 800;
                    oscillator.type = 'sine';

                    gainNode.gain.setValueAtTime(0.5, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);

                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.3);
                }, i * 400);
            }
        }

        function showNotification(message) {
            // Try browser notification first
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification('×œ×—× ××—××¦×ª', {
                    body: message,
                    icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y="80" font-size="80">ğŸ</text></svg>',
                    tag: 'sourdough-timer',
                    requireInteraction: true
                });
            } else {
                // Fallback to alert
                alert(message);
            }
        }

        function createNewBread() {
            const breadId = 'bread-' + Date.now();
            const breadNumber = Object.keys(breads).length + 1;
            breads[breadId] = {
                id: breadId,
                name: `×œ×—× #${breadNumber}`,
                currentStep: 0,
                timers: {},
                createdAt: Date.now()
            };
            currentBreadId = breadId;
            saveProgress();
            renderStep();
        }

        function switchBread(breadId) {
            currentBreadId = breadId;

            // Check if this bread has a running timer and jump to that step
            const bread = breads[breadId];
            if (bread) {
                // Find the step with a running timer
                for (const [timerId, timer] of Object.entries(bread.timers)) {
                    if (timer.running) {
                        // Extract step index from timerId (format: "timer-3")
                        const stepMatch = timerId.match(/timer-(\d+)/);
                        if (stepMatch) {
                            const stepIndex = parseInt(stepMatch[1]);
                            bread.currentStep = stepIndex;
                            break; // Only one timer can be running, so we can break
                        }
                    }
                }
            }

            saveProgress();
            renderStep();
        }

        function viewAllBreads() {
            currentBreadId = null;
            saveProgress();
            renderStep();
        }

        function confirmDeleteBread(breadId) {
            const bread = breads[breadId];
            if (!bread) return;

            const breadName = bread.name;
            const progress = Math.round((bread.currentStep + 1) / recipeSteps.length * 100);

            if (confirm(`×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª "${breadName}"?\n\n×”×ª×§×“××•×ª: ${progress}% (×©×œ×‘ ${bread.currentStep + 1}/${recipeSteps.length})\n\n×¤×¢×•×œ×” ×–×• ×œ× × ×™×ª× ×ª ×œ×‘×™×˜×•×œ!`)) {
                deleteBread(breadId);
            }
        }

        function deleteBread(breadId) {
            delete breads[breadId];

            // If we deleted the current bread, go back to bread selector
            if (currentBreadId === breadId) {
                currentBreadId = null;
            }

            // If no breads left, create a new one
            if (Object.keys(breads).length === 0) {
                createNewBread();
            } else {
                saveProgress();
                renderStep();
            }
        }

        function nextStep() {
            const bread = getCurrentBread();
            if (!bread) return;
            bread.currentStep++;
            saveProgress();
            window.scrollTo(0, 0);
            renderStep();
        }

        function previousStep() {
            const bread = getCurrentBread();
            if (!bread) return;
            if (bread.currentStep > 0) {
                bread.currentStep--;
                saveProgress();
                window.scrollTo(0, 0);
                renderStep();
            }
        }

        function saveProgress() {
            localStorage.setItem('sourdoughProgress', JSON.stringify({
                breads,
                currentBreadId
            }));
        }

        function loadProgress() {
            const saved = localStorage.getItem('sourdoughProgress');
            if (saved) {
                try {
                    const data = JSON.parse(saved);

                    // Load breads
                    if (data.breads) {
                        breads = data.breads;
                        currentBreadId = data.currentBreadId || null;
                    } else if (data.currentStep !== undefined) {
                        // Migrate old single-bread format
                        const breadId = 'bread-' + Date.now();
                        breads[breadId] = {
                            id: breadId,
                            name: '×œ×—× #1',
                            currentStep: data.currentStep || 0,
                            timers: data.timers || {},
                            createdAt: Date.now()
                        };
                        currentBreadId = breadId;
                    }
                } catch (e) {
                    console.error('Failed to load progress:', e);
                }
            }

            // Create first bread if none exist
            if (Object.keys(breads).length === 0) {
                createNewBread();
            }
        }

        async function loadRecipeFromURL() {
            const params = new URLSearchParams(window.location.search);
            const recipeUrl = params.get('recipe');

            if (recipeUrl) {
                await loadRecipeFromUrlString(recipeUrl);
            }
        }

        async function loadRecipeFromUrlString(url) {
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const recipe = await response.json();

                // Validate recipe structure
                if (!Array.isArray(recipe) || recipe.length === 0) {
                    throw new Error('×”××ª×›×•×Ÿ ×—×™×™×‘ ×œ×”×™×•×ª ××¢×¨×š ×¢× ×œ×¤×—×•×ª ×©×œ×‘ ××—×“');
                }

                // Validate each step has required fields
                for (let i = 0; i < recipe.length; i++) {
                    const step = recipe[i];
                    if (!step.title || !step.content) {
                        throw new Error(`×©×œ×‘ ${i + 1} ×—×¡×¨ ×©×“×•×ª × ×“×¨×©×™× (title, content)`);
                    }
                }

                recipeSteps = recipe;
                console.log('Loaded custom recipe from:', url);
                alert(`âœ… ×”××ª×›×•×Ÿ × ×˜×¢×Ÿ ×‘×”×¦×œ×—×”!\n\n${recipe.length} ×©×œ×‘×™× ×‘××ª×›×•×Ÿ ×”×—×“×©.`);

                // Reset all breads to use new recipe
                Object.keys(breads).forEach(id => {
                    breads[id].currentStep = 0;
                    breads[id].timers = {};
                });

                saveProgress();
                renderStep();

            } catch (e) {
                console.error('Failed to load recipe from URL:', e);
                alert(`âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×”××ª×›×•×Ÿ:\n\n${e.message}\n\n××©×ª××© ×‘××ª×›×•×Ÿ ×”× ×•×›×—×™.`);
            }
        }

        function loadCustomRecipe() {
            const input = document.getElementById('recipeUrlInput');
            const url = input ? input.value.trim() : '';

            if (!url) {
                alert('×× × ×”×–×Ÿ ×›×ª×•×‘×ª URL ×©×œ ××ª×›×•×Ÿ');
                return;
            }

            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                alert('×›×ª×•×‘×ª ×”-URL ×—×™×™×‘×ª ×œ×”×ª×—×™×œ ×‘-http:// ××• https://');
                return;
            }

            loadRecipeFromUrlString(url);
        }

        // Request notification permission
        if ('Notification' in window && Notification.permission === 'default') {
            Notification.requestPermission();
        }

        // Initialize app
        async function initApp() {
            await loadRecipeFromURL();
            loadProgress();
            startGlobalTimerUpdate();
            renderStep();
        }

        initApp();
    </script>
</body>
</html>